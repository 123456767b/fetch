<!DOCTYPE html><html lang="en-US"><meta charset="utf-8">
<title>Fetch Standard</title>
<link rel="stylesheet" href="//whatwg.org/style/specification">
<link rel="icon" href="//resources.whatwg.org/logo-fetch.svg">

<div class="head">

<p><a class="logo" href="//whatwg.org/"><img height="100" src="//resources.whatwg.org/logo-fetch.svg" width="100" alt="WHATWG"></a>
<h1 id="cors">Fetch</h1>
<h2 class="no-num no-toc" id="living-standard-—-last-updated-18-february-2015">Living Standard — Last Updated 18 February 2015</h2>

<dl>
 <dt>Participate:
 <dd>Send feedback to <a href="//whatwg.org/mailing-list">whatwg@whatwg.org</a>
 (<a href="http://lists.w3.org/Archives/Public/public-whatwg-archive/">archives</a>)
  or
  <a href="https://www.w3.org/Bugs/Public/enter_bug.cgi?product=WHATWG&amp;component=Fetch">file a bug</a>
  (<a href="https://www.w3.org/Bugs/Public/buglist.cgi?product=WHATWG&amp;component=Fetch&amp;resolution=---">open bugs</a>)
 <dd>Temporary: ServiceWorker <a href="https://github.com/slightlyoff/ServiceWorker/labels/fetch">issues labeled "fetch"</a>
 <dd><a href="//wiki.whatwg.org/wiki/IRC">IRC: #whatwg on Freenode</a>

 <dt>Commits:
 <dd><a href="https://github.com/whatwg/fetch/commits">https://github.com/whatwg/fetch/commits</a>
 <dd><a href="https://twitter.com/fetchstandard">@fetchstandard</a>
</dl>

<script async="" src="//resources.whatwg.org/file-bug.js"></script>

</div>



<h2 class="no-num no-toc short" id="abstract">Abstract</h2>

<p>The Fetch standard defines requests, responses, and the process that binds them;
fetching.



<h2 class="no-num no-toc" id="table-of-contents">Table of Contents</h2>

<!--begin-toc-->
<ol class="toc">
 <li><a class="no-num short" href="#goals">Goals</a></li>
 <li><a class="short" href="#conformance"><span class="secno">1 </span>Conformance</a></li>
 <li><a href="#infrastructure"><span class="secno">2 </span>Infrastructure</a>
  <ol class="toc">
   <li><a href="#http"><span class="secno">2.1 </span>HTTP</a>
    <ol class="toc">
     <li><a href="#methods"><span class="secno">2.1.1 </span>Methods</a></li>
     <li><a href="#terminology-headers"><span class="secno">2.1.2 </span>Headers</a></li>
     <li><a href="#bodies"><span class="secno">2.1.3 </span>Bodies</a></li>
     <li><a href="#requests"><span class="secno">2.1.4 </span>Requests</a></li>
     <li><a href="#responses"><span class="secno">2.1.5 </span>Responses</a></ol></li>
   <li><a href="#authentication-entries"><span class="secno">2.2 </span>Authentication entries</a></ol></li>
 <li><a href="#http-extensions"><span class="secno">3 </span>HTTP extensions</a>
  <ol class="toc">
   <li><a href="#origin-header"><span class="secno">3.1 </span>`<code title="">Origin</code>` header</a></li>
   <li><a href="#http-cors-protocol"><span class="secno">3.2 </span>CORS protocol</a>
    <ol class="toc">
     <li><a href="#general"><span class="secno">3.2.1 </span>General</a></li>
     <li><a href="#http-requests"><span class="secno">3.2.2 </span>HTTP requests</a></li>
     <li><a href="#http-responses"><span class="secno">3.2.3 </span>HTTP responses</a></li>
     <li><a href="#http-new-header-syntax"><span class="secno">3.2.4 </span>HTTP new header syntax</a></ol></ol></li>
 <li><a href="#fetching"><span class="secno">4 </span>Fetching</a>
  <ol class="toc">
   <li><a href="#basic-fetch"><span class="secno">4.1 </span>Basic fetch</a></li>
   <li><a href="#http-fetch"><span class="secno">4.2 </span>HTTP fetch</a></li>
   <li><a href="#http-network-or-cache-fetch"><span class="secno">4.3 </span>HTTP network or cache fetch</a></li>
   <li><a href="#http-network-fetch"><span class="secno">4.4 </span>HTTP network fetch</a></li>
   <li><a href="#cors-preflight-fetch"><span class="secno">4.5 </span>CORS preflight fetch</a></li>
   <li><a href="#cors-preflight-cache"><span class="secno">4.6 </span>CORS preflight cache</a></li>
   <li><a href="#cors-check"><span class="secno">4.7 </span>CORS check</a></ol></li>
 <li><a href="#fetch-api"><span class="secno">5 </span>Fetch API</a>
  <ol class="toc">
   <li><a href="#headers-class"><span class="secno">5.1 </span>Headers class</a></li>
   <li><a href="#body-mixin"><span class="secno">5.2 </span>Body mixin</a></li>
   <li><a href="#request-class"><span class="secno">5.3 </span>Request class</a></li>
   <li><a href="#response-class"><span class="secno">5.4 </span>Response class</a></li>
   <li><a href="#structured-cloning-of-headers,-request,-and-response-objects"><span class="secno">5.5 </span>Structured cloning of <code>Headers</code>, <code>Request</code>, and <code>Response</code> objects</a></li>
   <li><a href="#fetch-method"><span class="secno">5.6 </span>Fetch method</a></ol></li>
 <li><a class="no-num" href="#background-reading">Background reading</a>
  <ol class="toc">
   <li><a class="no-num" href="#http-header-layer-division">HTTP header layer division</a></li>
   <li><a class="no-num" href="#atomic-http-redirect-handling">Atomic HTTP redirect handling</a></li>
   <li><a class="no-num" href="#basic-safe-cors-protocol-setup">Basic safe CORS protocol setup</a></li>
   <li><a class="no-num" href="#cors-protocol-and-http-caches">CORS protocol and HTTP caches</a></ol></li>
 <li><a class="no-num" href="#references">References</a></li>
 <li><a class="no-num" href="#acknowledgments">Acknowledgments</a></ol>
<!--end-toc-->



<h2 class="no-num short" id="goals">Goals</h2>

<p>To unify fetching across the web platform this specification supplants a number of algorithms and specifications:

<ul class="brief no-backref">
 <li>HTML Standard's fetch and potentially CORS-enabled fetch algorithms
 <a class="informative" href="#refsHTML">[HTML]</a>
 <li>CORS <a class="informative" href="#refsCORS">[CORS]</a>
 <li>HTTP `<code title="http-origin"><a href="#http-origin">Origin</a></code>` header semantics
 <a class="informative" href="#refsORIGIN">[ORIGIN]</a>
</ul>

<p>Unifying fetching provides consistent handling of:

<ul class="brief">
 <li>URL schemes
 <li>Redirects
 <li>Cross-origin semantics
 <li>CSP <a href="#refsCSP">[CSP]</a>
 <li>Service Workers <a href="#refsSW">[SW]</a>
 <li>Mixed Content <a href="#refsMIX">[MIX]</a>
 <li>`<code title="">Referer</code>` <a href="#refsREFERRER">[REFERRER]</a>
</ul>



<h2 class="short" id="conformance"><span class="secno">1 </span>Conformance</h2>

<p>All diagrams, examples, and notes in this specification are
non-normative, as are all sections explicitly marked non-normative.
Everything else in this specification is normative.

<p>The key words "MUST", "MUST NOT", "REQUIRED", <!--"SHALL", "SHALL
NOT",--> "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and
"OPTIONAL" in the normative parts of this specification are to be
interpreted as described in RFC2119. For readability, these words do
not appear in all uppercase letters in this specification.
<a href="#refsRFC2119">[RFC2119]</a>



<h2 id="infrastructure"><span class="secno">2 </span>Infrastructure</h2>

<p>This specification uses terminology from the Encoding, HTML, and URL Standards.
<a href="#refsENCODING">[ENCODING]</a>
<a href="#refsHTML">[HTML]</a>
<a href="#refsURL">[URL]</a>

<p>A <a class="external" href="https://encoding.spec.whatwg.org/#byte">byte</a> sequence with bytes in the range 0x00 to
0x7F is represented as a <a class="external" href="https://encoding.spec.whatwg.org/#utf-8">utf-8</a> encoded
<a class="external" href="https://encoding.spec.whatwg.org/#string">string</a> with code points in the range U+0000 to
U+007F. To avoid confusion with an actual string backticks are used.

<p class="example">"<code title="">true</code>" is a
<a class="external" href="https://encoding.spec.whatwg.org/#string">string</a>, while `<code title="">true</code>` is a
byte sequence.

<p>Comparing two byte sequences in a <dfn id="byte-case-insensitive">byte case-insensitive</dfn> manner means
comparing them exactly, byte for byte, except that the bytes in the range 0x41 to 0x5A are
considered to also match their corresponding byte in the range 0x61 to 0x7A.

<p>A <dfn id="case-insensitive-byte-sequence">case-insensitive byte sequence</dfn> is a byte sequence that when compared to
another byte sequence does so in a <a href="#byte-case-insensitive">byte case-insensitive</a> manner.

<p class="example">The
<a title="case-insensitive byte sequence" href="#case-insensitive-byte-sequence">case-insensitive byte sequences</a>
`<code title="">Content-Type</code>` and `<code title="">content-TYPE</code>` are equal.

<p>To <dfn id="byte-lowercase">byte lowercase</dfn> a byte sequence, increase each byte it contains, in the
range 0x41 to 0x5A, by 0x20.

<p>To <dfn id="byte-uppercase">byte uppercase</dfn> a byte sequence, subtract each byte it contains, in the
range 0x61 to 0x7A, by 0x20.

<hr>

<p>To <dfn id="queue-a-fetch-task">queue a fetch task</dfn> on <a title="concept-request" href="#concept-request">request</a>
<var title="">request</var> to <var title="">run an operation</var>,
<a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">queue a task</a> to <var title="">run an operation</var> on
<var title="">request</var>'s <a title="concept-request-client" href="#concept-request-client">client</a>'s
<a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop">responsible event loop</a> using the
<a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#networking-task-source">networking task source</a>.


<h3 id="http"><span class="secno">2.1 </span>HTTP</h3>

<p>While <a title="concept-fetch" href="#concept-fetch">fetching</a> encompasses more than just HTTP, it
borrows a number of concepts from HTTP and applies these to resources obtained via other
means (e.g. <code title="">data</code> URLs).


<h4 id="methods"><span class="secno">2.1.1 </span>Methods</h4>

<p>A <dfn title="concept-method" id="concept-method">method</dfn> is a byte sequence that matches the
<a class="external" href="http://tools.ietf.org/html/rfc2616/#section-5.1.1">Method</a> token production.

<p>A <dfn id="simple-method">simple method</dfn> is a <a title="concept-method" href="#concept-method">method</a> that is
`<code title="">GET</code>`, `<code title="">HEAD</code>`, or `<code title="">POST</code>`.

<p>A <dfn id="forbidden-method">forbidden method</dfn> is a <a title="concept-method" href="#concept-method">method</a> that is a
<a href="#byte-case-insensitive">byte case-insensitive</a> match for one of `<code title="">CONNECT</code>`,
`<code title="">TRACE</code>`, and `<code title="">TRACK</code>`.
<a class="informative" href="#refsHTTPVERBSEC">[HTTPVERBSEC]</a>

<p>To <dfn title="concept-method-normalize" id="concept-method-normalize">normalize</dfn> a
<a title="concept-method" href="#concept-method">method</a>, if it is a <a href="#byte-case-insensitive">byte case-insensitive</a>
match for `<code title="">DELETE</code>`, `<code title="">GET</code>`,
`<code title="">HEAD</code>`, `<code title="">OPTIONS</code>`, `<code title="">POST</code>`, or
`<code title="">PUT</code>`, <a href="#byte-uppercase">byte uppercase</a> it.

<p class="note no-backref"><a title="concept-method-normalize" href="#concept-method-normalize">Normalization</a> is
done for backwards compatibility and consistency across APIs as
<a title="concept-method" href="#concept-method">methods</a> are actually "case-sensitive".


<h4 id="terminology-headers"><span class="secno">2.1.2 </span>Headers</h4>

<p>A <dfn title="concept-header-list" id="concept-header-list">header list</dfn> consists of zero or more
<a title="concept-header" href="#concept-header">headers</a>.

<p>To <dfn title="concept-header-list-append" id="concept-header-list-append">append</dfn> a
<a title="concept-header-name" href="#concept-header-name">name</a>/<a title="concept-header-value" href="#concept-header-value">value</a>
(<var title="">name</var>/<var title="">value</var>) pair to a
<a title="concept-header-list" href="#concept-header-list">header list</a> (<var title="">list</var>), append a new
<a title="concept-header" href="#concept-header">header</a> whose <a title="concept-header-name" href="#concept-header-name">name</a>
is <var title="">name</var>, <a title="byte lowercase" href="#byte-lowercase">byte lowercased</a>, and
<a title="concept-header-value" href="#concept-header-value">value</a> is <var title="">value</var>, to
<var title="">list</var>.

<p>To <dfn title="concept-header-list-delete" id="concept-header-list-delete">delete</dfn> a
<a title="concept-header-name" href="#concept-header-name">name</a> (<var title="">name</var>) from a
<a title="concept-header-list" href="#concept-header-list">header list</a> (<var title="">list</var>), remove all
<a title="concept-header" href="#concept-header">headers</a> whose
<a title="concept-header-name" href="#concept-header-name">name</a> is <var title="">name</var>,
<a title="byte lowercase" href="#byte-lowercase">byte lowercased</a>, from <var title="">list</var>.

<p>To <dfn title="concept-header-list-set" id="concept-header-list-set">set</dfn> a
<a title="concept-header-name" href="#concept-header-name">name</a>/<a title="concept-header-value" href="#concept-header-value">value</a>
(<var title="">name</var>/<var title="">value</var>) pair in a
<a title="concept-header-list" href="#concept-header-list">header list</a> (<var title="">list</var>), run these
steps:

<ol>
 <li><p><a href="#byte-lowercase">Byte lowercase</a> <var title="">name</var>.

 <li><p>If there are any <a title="concept-header" href="#concept-header">headers</a> in
 <var title="">list</var> whose <a title="concept-header-name" href="#concept-header-name">name</a> is
 <var title="">name</var>, set the <a title="concept-header-value" href="#concept-header-value">value</a> of the first
 such <a title="concept-header" href="#concept-header">header</a> to <var title="">value</var> and remove the
 others.

 <li><p>Otherwise, append a new <a title="concept-header" href="#concept-header">header</a> whose
 <a title="concept-header-name" href="#concept-header-name">name</a> is <var title="">name</var> and
 <a title="concept-header-value" href="#concept-header-value">value</a> is <var title="">value</var>, to
 <var title="">list</var>.
</ol>

<p>To <dfn title="concept-header-list-combine" id="concept-header-list-combine">combine</dfn> a
<a title="concept-header-name" href="#concept-header-name">name</a>/<a title="concept-header-value" href="#concept-header-value">value</a>
(<var title="">name</var>/<var title="">value</var>) pair in a
<a title="concept-header-list" href="#concept-header-list">header list</a> (<var title="">list</var>), run these
steps:

<ol>
 <li><p><a href="#byte-lowercase">Byte lowercase</a> <var title="">name</var>.

 <li><p>If there are any <a title="concept-header" href="#concept-header">headers</a> in
 <var title="">list</var> whose <a title="concept-header-name" href="#concept-header-name">name</a> is
 <var title="">name</var>, set the <a title="concept-header-value" href="#concept-header-value">value</a> of the first
 such <a title="concept-header" href="#concept-header">header</a> to
 <a title="concept-header-value" href="#concept-header-value">value</a>, followed by 0x2C 0x20, followed by <var title="">value</var>.

 <li><p>Otherwise, append a new <a title="concept-header" href="#concept-header">header</a> whose
 <a title="concept-header-name" href="#concept-header-name">name</a> is <var title="">name</var> and
 <a title="concept-header-value" href="#concept-header-value">value</a> is <var title="">value</var>, to
 <var title="">list</var>.
</ol>

<p class="note no-backref"><a title="concept-header-list-combine" href="#concept-header-list-combine">Combine</a> solely
exists for <code class="external"><a href="https://xhr.spec.whatwg.org/#xmlhttprequest">XMLHttpRequest</a></code>.

<hr>

<p>A <dfn title="concept-header" id="concept-header">header</dfn> consists of a
<dfn title="concept-header-name" id="concept-header-name">name</dfn> and <dfn title="concept-header-value" id="concept-header-value">value</dfn>.
A <a title="concept-header-name" href="#concept-header-name">name</a> is a
<a href="#case-insensitive-byte-sequence">case-insensitive byte sequence</a> that matches the
<a class="external" href="http://tools.ietf.org/html/rfc2616/#section-4.2">field-name</a> token production. A
<a title="concept-header-value" href="#concept-header-value">value</a> is a byte sequence that matches the
<a class="external" href="http://tools.ietf.org/html/rfc2616/#section-4.2">field-value</a> token production and contains no 0x0A or
0x0D bytes.

<p class="note">Allowing 0x0A and 0x0D bytes can lead to reparsing issues.

<hr>

<p>A <dfn id="simple-header">simple header</dfn> is a <a title="concept-header" href="#concept-header">header</a> whose
<a title="concept-header-name" href="#concept-header-name">name</a> is either one of `<code title="">Accept</code>`,
`<code title="">Accept-Language</code>`, and `<code title="">Content-Language</code>`, or whose
<a title="concept-header-name" href="#concept-header-name">name</a> is `<code title="">Content-Type</code>` and
<a title="concept-header-value" href="#concept-header-value">value</a>,
<a title="concept-header-parse" href="#concept-header-parse">once parsed</a>, has a MIME type (ignoring parameters)
that is one of `<code title="">application/x-www-form-urlencoded</code>`,
`<code title="">multipart/form-data</code>`, and `<code title="">text/plain</code>`.
<!-- XXX * needs better xref
         * ignoring parameters has been the standard for a long time now
         * interesting test: "Content-Type: text/plain;" -->

<p>A <dfn id="forbidden-header-name">forbidden header name</dfn> is a <a title="concept-header" href="#concept-header">header</a>
<a title="concept-header-name" href="#concept-header-name">name</a> that either is one of

<ul class="brief">
 <li>`<code title="">Accept-Charset</code>`
 <li>`<code title="">Accept-Encoding</code>`
 <li>`<code title="">Access-Control-Request-Headers</code>`
 <li>`<code title="">Access-Control-Request-Method</code>`
 <li>`<code title="">Connection</code>`
 <li>`<code title="">Content-Length</code>`
 <li>`<code title="">Cookie</code>`
 <li>`<code title="">Cookie2</code>`
 <li>`<code title="">Date</code>`
 <li>`<code title="">DNT</code>`
 <li>`<code title="">Expect</code>`
 <li>`<code title="">Host</code>`
 <li>`<code title="">Keep-Alive</code>`
 <li>`<code title="http-origin"><a href="#http-origin">Origin</a></code>`
 <li>`<code title="">Referer</code>`
 <li>`<code title="">TE</code>`
 <li>`<code title="">Trailer</code>`
 <li>`<code title="">Transfer-Encoding</code>`
 <li>`<code title="">Upgrade</code>`
 <li>`<code title="">User-Agent</code>`
 <li>`<code title="">Via</code>`
</ul>

<p>or starts with `<code title="">Proxy-</code>` or `<code title="">Sec-</code>`
(including when it is just `<code title="">Proxy-</code>` or `<code title="">Sec-</code>`).

<p class="note">These are forbidden so the user agent remains in full control over them.
<a title="concept-header-name" href="#concept-header-name">Names</a> starting with `<code title="">Sec-</code>` are
reserved to allow new <a title="concept-header" href="#concept-header">headers</a> to be minted that are safe
from APIs using <a title="concept-fetch" href="#concept-fetch">fetch</a> that allow control over
<a title="concept-header" href="#concept-header">headers</a> by developers, such as
<code class="external"><a href="https://xhr.spec.whatwg.org/#xmlhttprequest">XMLHttpRequest</a></code>.
<a class="informative" href="#refsXHR">[XHR]</a>

<p>A <dfn id="forbidden-response-header-name">forbidden response header name</dfn> is a <a title="concept-header" href="#concept-header">header</a>
<a title="concept-header-name" href="#concept-header-name">name</a> that is one of:

<ul class="brief">
 <li>`<code title="">Set-Cookie</code>`
 <li>`<code title="">Set-Cookie2</code>`
</ul>

<hr>

<p>To <dfn title="concept-header-parse" id="concept-header-parse">parse a header value</dfn> given a
<a title="concept-header-name" href="#concept-header-name">name</a> (<var title="">name</var>)  and either a
<a title="concept-header" href="#concept-header">header</a> or a
<a title="concept-header-list" href="#concept-header-list">header list</a> (<var title="">headers</var>), run these
steps:

<ol>
 <li><p>If <var title="">name</var> is not in <var title="">headers</var>, return null.

 <li>
  <p>If the ABNF for <var title="">name</var> allows a single
  <a title="concept-header" href="#concept-header">header</a> and <var title="">headers</var> contains more than
  one, return failure.

  <p class="note no-backref">That if you require different error handling, you need to
  extract the desired <a title="concept-header" href="#concept-header">header</a> first.

 <li><p>If parsing all the <a title="concept-header" href="#concept-header">headers</a>
 <a title="concept-header-name" href="#concept-header-name">named</a> <var title="">name</var> in
 <var title="">headers</var>, per the ABNF for <var title="">name</var>, failed, return failure.

 <li><p>Return one or more <a title="concept-header-value" href="#concept-header-value">values</a> resulting from
 parsing all the <a title="concept-header" href="#concept-header">headers</a>
 <a title="concept-header-name" href="#concept-header-name">named</a> <var title="">name</var> in
 <var title="">headers</var>, per the ABNF for <var title="">name</var>.
</ol>

<p>To <dfn title="concept-header-extract-MIME-type" id="concept-header-extract-mime-type">extract a MIME type</dfn> from a
<a title="concept-header-list" href="#concept-header-list">header list</a> (<var title="">headers</var>), run these
steps:

<ol>
 <li><p>Let <var title="">MIMEType</var> be the result of
 <a title="concept-header-parse" href="#concept-header-parse">parsing</a> `<code title="">Content-Type</code>` in
 <var title="">headers</var>.

 <li><p>If <var title="">MIMEType</var> is null or failure, return the empty byte sequence.

 <li><p>Return <var title="">MIMEType</var>,
 <a title="byte lowercase" href="#byte-lowercase">byte lowercased</a>.
</ol>

<h4 id="bodies"><span class="secno">2.1.3 </span>Bodies</h4>

<p>A <dfn title="concept-body" id="concept-body">body</dfn> is a byte stream. It has an associated
<dfn title="concept-body-transmitted" id="concept-body-transmitted">transmitted</dfn> which is an integer and initially 0,
<dfn title="concept-body-length" id="concept-body-length">length</dfn> which is an integer and initially 0, and
<dfn title="concept-body-error-flag" id="concept-body-error-flag">error flag</dfn> which is initially unset.

<p>To <dfn id="handle-content-codings">handle content codings</dfn> given <var title="">codings</var> and
<var title="">bytes</var>, run these substeps:

<ol>
 <li><p>If <var title="">codings</var> are not supported, return <var title="">bytes</var>.

 <li><p>Return the result of decoding bytes with the given
 <var title="">codings</var> as explained in HTTP. <a href="#refsHTTP">[HTTP]</a>
</ol>
<!-- XXX no hook in HTTP -->

<h4 id="requests"><span class="secno">2.1.4 </span>Requests</h4>

<p>The input to <a title="concept-fetch" href="#concept-fetch">fetch</a> is a
<dfn title="concept-request" id="concept-request">request</dfn>.

<p>A <a title="concept-request" href="#concept-request">request</a> has an associated
<dfn title="concept-request-method" id="concept-request-method">method</dfn> (a
<a title="concept-method" href="#concept-method">method</a>). Unless stated otherwise it is
`<code title="">GET</code>`.

<p>A <a title="concept-request" href="#concept-request">request</a> has an associated
<dfn title="concept-request-url" id="concept-request-url">url</dfn> (a
<a title="concept-url" class="external" href="https://url.spec.whatwg.org/#concept-url">URL</a>).

<p class="note no-backref">This is updated during redirects as described in
<a title="concept-http-fetch" href="#concept-http-fetch">HTTP fetch</a>.

<p>A <a title="concept-request" href="#concept-request">request</a> has an associated
<dfn id="local-urls-only-flag">local URLs only flag</dfn>. Unless stated otherwise it is unset.

<p>A <a title="concept-request" href="#concept-request">request</a> has an associated
<dfn id="sandboxed-storage-area-urls-flag">sandboxed storage area URLs flag</dfn>. Unless stated otherwise it is unset.

<p>A <a title="concept-request" href="#concept-request">request</a> has an associated
<dfn title="concept-request-header-list" id="concept-request-header-list">header list</dfn> (a
<a title="concept-header-list" href="#concept-header-list">header list</a>). Unless stated otherwise it is empty.

<p>A <a title="concept-request" href="#concept-request">request</a> has an associated
<dfn id="unsafe-request-flag">unsafe request flag</dfn>. Unless stated otherwise it is unset.

<p class="note no-backref">The <a href="#unsafe-request-flag">unsafe request flag</a> is set by APIs such as
<code title="dom-global-fetch"><a href="#dom-global-fetch">fetch()</a></code>  and
<code class="external"><a href="https://xhr.spec.whatwg.org/#xmlhttprequest">XMLHttpRequest</a></code> to ensure a
<a href="#cors-preflight-fetch-0">CORS preflight fetch</a> is done based on the supplied
<a title="concept-request-method" href="#concept-request-method">method</a> and
<a title="concept-request-header-list" href="#concept-request-header-list">header list</a>. It does not free an API from
outlawing <a title="forbidden method" href="#forbidden-method">forbidden methods</a> and
<a title="forbidden header name" href="#forbidden-header-name">forbidden header names</a>.

<p>A <a title="concept-request" href="#concept-request">request</a> has an associated
<dfn title="concept-request-body" id="concept-request-body">body</dfn> (null or a
<a title="concept-body" href="#concept-body">body</a>). Unless stated otherwise it is null.

<hr>

<p>A <a title="concept-request" href="#concept-request">request</a> has an associated
<dfn title="concept-request-client" id="concept-request-client">client</dfn> (an
<a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object">environment settings object</a>).

<p>A <a title="concept-request" href="#concept-request">request</a> has an associated
<dfn id="skip-service-worker-flag">skip service worker flag</dfn>. Unless stated otherwise it is unset.

<p>A <a title="concept-request" href="#concept-request">request</a> has an associated
<dfn title="concept-request-context" id="concept-request-context">context</dfn>, which is one of
"<code title="">audio</code>",
"<code title="">beacon</code>",
"<code title="">cspreport</code>",
"<code title="">download</code>",
"<code title="">embed</code>",
"<code title="">eventsource</code>",
"<code title="">favicon</code>",
"<code title="">fetch</code>",
"<code title="">font</code>",
"<code title="">form</code>",
"<code title="">frame</code>",
"<code title="">hyperlink</code>",
"<code title="">iframe</code>",
"<code title="">image</code>",
"<code title="">imageset</code>",
"<code title="">import</code>",
"<code title="">internal</code>",
"<code title="">location</code>",
"<code title="">manifest</code>",
"<code title="">object</code>",
"<code title="">ping</code>",
"<code title="">plugin</code>",
"<code title="">prefetch</code>",
"<code title="">script</code>",
"<code title="">serviceworker</code>",
"<code title="">sharedworker</code>",
"<code title="">subresource</code>",
"<code title="">style</code>",
"<code title="">track</code>",
"<code title="">video</code>",
"<code title="">worker</code>",
"<code title="">xmlhttprequest</code>", and
"<code title="">xslt</code>".
<!--
https://wiki.whatwg.org/wiki/Contexts
https://developer.mozilla.org/en-US/docs/Mozilla/Tech/XPCOM/Reference/Interface/nsIContentPolicy
-->

<p>A <a title="concept-request" href="#concept-request">request</a> has an associated
<dfn title="concept-request-context-frame-type" id="concept-request-context-frame-type">context frame type</dfn>, which is one of
"<code title="">auxiliary</code>", "<code title="">top-level</code>",
"<code title="">nested</code>", and "<code title="">none</code>". Unless stated otherwise it is
"<code title="">none</code>".

<p class="XXX">Remove "<code title="">auxiliary</code>"? Not sure it is distinctive enough.

<div class="note">
 <p>The following table illustrates the relationship between a
 <a title="concept-request" href="#concept-request">request</a>'s
 <a title="concept-request-context" href="#concept-request-context">context</a>, its
 <a title="concept-request-context-frame-type" href="#concept-request-context-frame-type">context frame type</a>, and
 CSP directives:

 <table>
  <tr>
   <th><a title="concept-request-context" href="#concept-request-context">context</a>
   <th><a title="concept-request-context-frame-type" href="#concept-request-context-frame-type">context frame type</a>
   <th>CSP directive
   <th>Platform feature example
  <tr>
   <td>"<code title="">audio</code>"
   <td>"<code title="">none</code>"
   <td><code title="">media-src</code>
   <td>HTML's <code>audio</code> element
  <tr>
   <td>"<code title="">beacon</code>"
   <td>"<code title="">none</code>"
   <td><code title="">connect-src</code>
   <td><code>navigator.sendBeacon()</code>
  <tr>
   <td>"<code title="">cspreport</code>"
   <td>"<code title="">none</code>"
   <td><code title="">connect-src</code>
   <td>CSP's report feature
  <tr>
   <td>"<code title="">download</code>"
   <td>"<code title="">none</code>"
   <td>—
   <td>HTML's <code>a</code> element when its <code>download</code> attribute is set
  <tr>
   <td>"<code title="">embed</code>"
   <td>"<code title="">none</code>"
   <td><code title="">object-src</code>
   <td>HTML's <code>embed</code> element
  <tr>
   <td>"<code title="">eventsource</code>"
   <td>"<code title="">none</code>"
   <td><code title="">connect-src</code>
   <td><code>EventSource</code>
  <tr>
   <td>"<code title="">favicon</code>"
   <td>"<code title="">none</code>"
   <td>—
   <td><code title="">/favicon.ico</code> resource
  <tr>
   <td>"<code title="">fetch</code>"
   <td>"<code title="">none</code>"
   <td><code title="">connect-src</code>
   <td><code title="dom-global-fetch"><a href="#dom-global-fetch">fetch()</a></code>
  <tr>
   <td>"<code title="">font</code>"
   <td>"<code title="">none</code>"
   <td><code title="">font-src</code>
   <td>CSS' <code>@font-face</code>
  <tr>
   <td>"<code title="">form</code>"
   <td>any but "<code title="">none</code>"
   <td><code title="">form-action</code>, potentially <code title="">child-src</code>
   <td>HTML's <code>form</code> element
  <tr>
   <td>"<code title="">frame</code>"
   <td>"<code title="">nested</code>"
   <td><code title="">child-src</code>
   <td>HTML's <code>frame</code> element
  <tr>
   <td>"<code title="">hyperlink</code>"
   <td>any but "<code title="">none</code>"
   <td>potentially <code title="">child-src</code>
   <td>HTML's <code>a</code> element
  <tr>
   <td>"<code title="">iframe</code>"
   <td>"<code title="">nested</code>"
   <td><code title="">child-src</code>
   <td>HTML's <code>iframe</code> element
  <tr>
   <td>"<code title="">image</code>"
   <td>"<code title="">none</code>"
   <td><code title="">img-src</code>
   <td>SVG's <code>image</code> element
  <tr>
   <td>"<code title="">imageset</code>"
   <td>"<code title="">none</code>"
   <td><code title="">img-src</code>
   <td>HTML's <code>picture</code> element
  <tr>
   <td>"<code title="">import</code>"
   <td>"<code title="">none</code>"
   <td><code title="">script-src</code>
   <td>HTML's <code>link</code> element when its <code>rel</code> attribute is set to
   "<code>import</code>"
  <tr>
   <td>"<code title="">internal</code>"
   <td>any
   <td>—
   <td>User agent actions such as refresh, back, forward; other user agent usage
  <tr>
   <td>"<code title="">location</code>"
   <td>any but "<code title="">none</code>"
   <td>potentially <code title="">child-src</code>
   <td><code title="">window.location</code>
  <tr>
   <td>"<code title="">manifest</code>"
   <td>"<code title="">none</code>"
   <td>—
   <td>HTML's <code>link</code> element when its <code>rel</code> attribute is set to
   "<code>manifest</code>"
  <tr>
   <td>"<code title="">object</code>"
   <td>"<code title="">none</code>"
   <td><code title="">object-src</code>
   <td>HTML's <code>object</code> element
  <tr>
   <td>"<code title="">ping</code>"
   <td>"<code title="">none</code>"
   <td><code title="">connect-src</code>
   <td>HTML's <code>ping</code> attribute
  <tr>
   <td>"<code title="">plugin</code>"
   <td>"<code title="">none</code>"
   <td>—
   <td>A <a title="concept-fetch" href="#concept-fetch">fetch</a> from a plugin
  <tr>
   <td>"<code title="">prefetch</code>"
   <td>"<code title="">none</code>"
   <td>—
   <td>HTML's <code>link</code> element when its <code>rel</code> attribute is set to
   "<code>prefetch</code>"
  <tr>
   <td>"<code title="">script</code>"
   <td>"<code title="">none</code>"
   <td><code title="">script-src</code>
   <td>HTML's <code>script</code> element
  <tr>
   <td>"<code title="">serviceworker</code>"
   <td>"<code title="">none</code>"
   <td>—
   <td><code title="">navigator.serviceWorker.register()</code>
  <tr>
   <td>"<code title="">sharedworker</code>"
   <td>"<code title="">none</code>"
   <td><code title="">child-src</code>
   <td><code>SharedWorker</code>
  <tr>
   <td>"<code title="">subresource</code>"
   <td>"<code title="">none</code>"
   <td>—
   <td>HTML's <code>link</code> element when its <code>rel</code> attribute is set to
   "<code>subresource</code>"
  <tr>
   <td>"<code title="">style</code>"
   <td>"<code title="">none</code>"
   <td><code title="">style-src</code>
   <td>HTML's <code>link</code> element when its <code>rel</code> attribute is set to
   "<code>stylesheet</code>"
  <tr>
   <td>"<code title="">track</code>"
   <td>"<code title="">none</code>"
   <td><code title="">media-src</code>
   <td>HTML's <code>track</code> element
  <tr>
   <td>"<code title="">video</code>"
   <td>"<code title="">none</code>"
   <td><code title="">media-src</code>
   <td>HTML's <code>video</code> element
  <tr>
   <td>"<code title="">worker</code>"
   <td>"<code title="">none</code>"
   <td><code title="">child-src</code>
   <td><code>Worker</code>
  <tr>
   <td>"<code title="">xmlhttprequest</code>"
   <td>"<code title="">none</code>"
   <td><code title="">connect-src</code>
   <td><code class="external"><a href="https://xhr.spec.whatwg.org/#xmlhttprequest">XMLHttpRequest</a></code>
  <tr>
   <td>"<code title="">xslt</code>"
   <td>"<code title="">none</code>"
   <td><code title="">script-src</code>
   <td><code>&lt;?xml-stylesheet&gt;</code>
 </table>
</div>

<hr>

<p>A <a title="concept-request" href="#concept-request">request</a> has an associated
<dfn title="concept-request-origin" id="concept-request-origin">origin</dfn> (an
<a class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#origin">origin</a>). Unless stated otherwise it is an
opaque identifier.

<p>A <a title="concept-request" href="#concept-request">request</a> has an associated
<dfn id="force-origin-header-flag">force <code title="">Origin</code> header flag</dfn>. Unless stated otherwise it is unset.

<p>A <a title="concept-request" href="#concept-request">request</a> has an associated
<dfn id="same-origin-data-url-flag">same-origin data URL flag</dfn>. Unless stated otherwise it is unset.

<p>A <a title="concept-request" href="#concept-request">request</a> has an associated
<dfn title="concept-request-referrer" id="concept-request-referrer">referrer</dfn>, which is <i title="">no referrer</i>,
<i title="">client</i>, or a <a title="concept-url" class="external" href="https://url.spec.whatwg.org/#concept-url">URL</a>. Unless
stated otherwise it is <i title="">client</i>.

<p>A <a title="concept-request" href="#concept-request">request</a> has an associated
<dfn id="authentication-flag">authentication flag</dfn>. Unless stated otherwise it is unset.

<p>A <a title="concept-request" href="#concept-request">request</a> has an associated
<dfn id="synchronous-flag">synchronous flag</dfn>. Unless stated otherwise it is unset.

<p>A <a title="concept-request" href="#concept-request">request</a> has an associated
<dfn title="concept-request-mode" id="concept-request-mode">mode</dfn>, which is one of "<code title="">same-origin</code>",
"<code title="">no-cors</code>", "<code title="">cors</code>", and
"<code title="">cors-with-forced-preflight</code>". Unless stated otherwise, it is
"<code title="">no-cors</code>".

<p>A <a title="concept-request" href="#concept-request">request</a> has an associated
<dfn title="concept-request-credentials-mode" id="concept-request-credentials-mode">credentials mode</dfn>, which is
one of "<code title="">omit</code>", "<code title="">same-origin</code>", and
"<code title="">include</code>". Unless stated otherwise, it is "<code title="">omit</code>".

<p>A <a title="concept-request" href="#concept-request">request</a> has an associated
<dfn title="concept-request-use-url-credentials-flag" id="concept-request-use-url-credentials-flag">use URL credentials flag</dfn>.
Unless stated otherwise, it is unset.

<p>A <a title="concept-request" href="#concept-request">request</a> has an associated
<dfn title="concept-request-cache-mode" id="concept-request-cache-mode">cache mode</dfn>, which is one of
"<code title="">default</code>", "<code title="">no-store</code>", "<code title="">reload</code>",
"<code title="">no-cache</code>", "<code title="">force-cache</code>", and
"<code title="">only-if-cached</code>". Unless stated otherwise, it is
"<code title="">default</code>".

<p class="note no-backref">If <a title="concept-request-header-list" href="#concept-request-header-list">header list</a>
contains a <a title="concept-header" href="#concept-header">header</a> whose
<a title="concept-header-name" href="#concept-header-name">name</a> is one of
`<code title="">If-Modified-Since</code>`,
`<code title="">If-None-Match</code>`,
`<code title="">If-Unmodified-Since</code>`,
`<code title="">If-Match</code>`, and
`<code title="">If-Range</code>`, <a title="concept-fetch" href="#concept-fetch">fetch</a> will set
<a title="concept-request-cache-mode" href="#concept-request-cache-mode">cache mode</a> to "<code title="">no-store</code>"
if it is "<code title="">default</code>".

<p>A <a title="concept-request" href="#concept-request">request</a> has an associated
<dfn title="concept-request-manual-redirect-flag" id="concept-request-manual-redirect-flag">manual redirect flag</dfn>. Unless stated
otherwise, it is unset.

<hr>

<p>A <a title="concept-request" href="#concept-request">request</a> has an associated
<dfn title="concept-request-redirect-count" id="concept-request-redirect-count">redirect count</dfn>. Unless stated otherwise,
it is zero.

<p>A <a title="concept-request" href="#concept-request">request</a> has an associated
<dfn title="concept-request-response-tainting" id="concept-request-response-tainting">response tainting</dfn>, which is one of
"<code title="">basic</code>", "<code title="">cors</code>", and "<code title="">opaque</code>".
Unless stated otherwise, it is "<code title="">basic</code>".

<p class="note no-backref">A <a title="concept-request" href="#concept-request">request</a>'s
<a title="concept-request-redirect-count" href="#concept-request-redirect-count">redirect count</a> and
<a title="concept-request-response-tainting" href="#concept-request-response-tainting">response tainting</a> are used as
bookkeeping details by the <a title="concept-fetch" href="#concept-fetch">fetch</a> algorithm.

<hr>

<p>A <dfn id="client-request">client request</dfn> is a <a title="concept-request" href="#concept-request">request</a> whose
<a title="concept-request-context" href="#concept-request-context">context</a> is one of
"<code title="">form</code>",
"<code title="">frame</code>",
"<code title="">hyperlink</code>",
"<code title="">iframe</code>",
"<code title="">internal</code>" (as long as <a title="concept-request-context-frame-type" href="#concept-request-context-frame-type">context frame type</a> is not "<code title="">none</code>"),
"<code title="">location</code>",
"<code title="">serviceworker</code>",
"<code title="">sharedworker</code>", and
"<code title="">worker</code>".

<p>A <dfn id="potential-client-request">potential client request</dfn> is a <a title="concept-request" href="#concept-request">request</a>
whose <a title="concept-request-context" href="#concept-request-context">context</a> is "<code title="">embed</code>" or
"<code title="">object</code>".

<p>A <dfn id="resource-request">resource request</dfn> is a <a title="concept-request" href="#concept-request">request</a> that is
neither a <a href="#client-request">client request</a> nor a <a href="#potential-client-request">potential client request</a>.

<!-- These concepts are introduced for service workers. At some point we should xref that. -->


<h4 id="responses"><span class="secno">2.1.5 </span>Responses</h4>

<p>The result of <a title="concept-fetch" href="#concept-fetch">fetch</a> is a
<dfn title="concept-response" id="concept-response">response</dfn>. A <a title="concept-response" href="#concept-response">response</a>
evolves over time. That is, not all its fields are available straight away.

<p>A <a title="concept-response" href="#concept-response">response</a> has an associated
<dfn title="concept-response-type" id="concept-response-type">type</dfn> which is one of
"<code title="">basic</code>",
"<code title="">cors</code>",
"<code title="">default</code>",
<i title="">error</i>, and
"<code title="">opaque</code>".
Unless stated otherwise, it is "<code title="">default</code>".

<p>A <a title="concept-response" href="#concept-response">response</a> can have an associated
<dfn title="concept-response-termination-reason" id="concept-response-termination-reason">termination reason</dfn> which is one of
<i title="">end-user abort</i>, <i title="">fatal</i>, and <i title="">timeout</i>.

<p>A <a title="concept-response" href="#concept-response">response</a> has an associated
<dfn title="concept-response-url" id="concept-response-url">url</dfn> (null or a
<a title="concept-url" class="external" href="https://url.spec.whatwg.org/#concept-url">URL</a>). Unless stated otherwise it is
null.

<p>A <a title="concept-response" href="#concept-response">response</a> has an associated
<dfn title="concept-response-final-url-flag" id="concept-response-final-url-flag">final url flag</dfn>. Unless stated otherwise
it is unset.

<p>A <a title="concept-response" href="#concept-response">response</a> has an associated
<dfn title="concept-response-status" id="concept-response-status">status</dfn>. Unless stated otherwise it is
<code title="">200</code>.

<p>A <a title="concept-response" href="#concept-response">response</a> has an associated
<dfn title="concept-response-status-message" id="concept-response-status-message">status message</dfn>. Unless stated otherwise
it is `<code title="">OK</code>`.

<p>A <a title="concept-response" href="#concept-response">response</a> has an associated
<dfn title="concept-response-header-list" id="concept-response-header-list">header list</dfn> (a
<a title="concept-header-list" href="#concept-header-list">header list</a>). Unless stated otherwise it is empty.

<p>A <a title="concept-response" href="#concept-response">response</a> has an associated
<dfn title="concept-response-body" id="concept-response-body">body</dfn> (null or a
<a title="concept-body" href="#concept-body">body</a>). Unless stated otherwise it is null.

<p>A <a title="concept-response" href="#concept-response">response</a> has an associated
<dfn title="concept-response-cache-state" id="concept-response-cache-state">cache state</dfn> which is one of
"<code title="">none</code>",
<i title="">local</i>,
<i title="">validated</i>, and
<i title="">partial</i>. Unless stated otherwise, it is "<code title="">none</code>".

<p>A <a title="concept-response" href="#concept-response">response</a> has an associated
<dfn title="concept-response-tls-state" id="concept-response-tls-state">TLS state</dfn> which is one of
<i title="">unauthenticated</i>,
<i title="">deprecated authentication</i>, and
<i title="">authenticated</i>. Unless stated otherwise, it is <i title="">unauthenticated</i>.

<p class="note no-backref">A <a title="concept-response" href="#concept-response">response</a> delivered over
TLS will typically have its <a title="concept-response-tls-state" href="#concept-response-tls-state">TLS state</a> set to
<i title="">authenticated</i>.

<hr>

<p>A <a title="concept-response" href="#concept-response">response</a> whose
<a title="concept-response-type" href="#concept-response-type">type</a> is <i title="">error</i> is known as a
<dfn title="concept-network-error" id="concept-network-error">network error</dfn>.

<p>A <a title="concept-network-error" href="#concept-network-error">network error</a> is a
<a title="concept-response" href="#concept-response">response</a> whose
<a title="concept-response-status" href="#concept-response-status">status</a> is always <code title="">0</code>,
<a title="concept-response-status-message" href="#concept-response-status-message">status message</a> is always the empty byte sequence,
<a title="concept-response-header-list" href="#concept-response-header-list">header list</a> is always empty,
<a title="concept-response-body" href="#concept-response-body">body</a> is always null, and
<a title="concept-response-cache-state" href="#concept-response-cache-state">cache state</a> is always "<code title="">none</code>".

<!-- XXX Introduce concept-redirect and concept-redirect-location for navigate algorithm? -->

<hr>

<p>A <dfn title="concept-filtered-response" id="concept-filtered-response">filtered response</dfn> is a limited view on a
<a title="concept-response" href="#concept-response">response</a> that is not a
<a title="concept-network-error" href="#concept-network-error">network error</a>. This
<a title="concept-response" href="#concept-response">response</a> is referred to as the
<a title="concept-filtered-response" href="#concept-filtered-response">filtered response</a>'s associated
<dfn title="concept-internal-response" id="concept-internal-response">internal response</dfn>.

<p class="note no-backref">The <a title="concept-fetch" href="#concept-fetch">fetch</a> algorithm returns
such a view to ensure APIs do not accidentally leak information. If the information is
required, e.g. to feed image data to a decoder, the associated
<a title="concept-internal-response" href="#concept-internal-response">internal response</a> can be used, which is only
"accessible" to internal specification algorithms.

<p>A <dfn title="concept-filtered-response-basic" id="concept-filtered-response-basic">basic filtered response</dfn> is a
<a title="concept-filtered-response" href="#concept-filtered-response">filtered response</a> whose
<a title="concept-response-type" href="#concept-response-type">type</a> is "<code title="">basic</code>",
<a title="concept-response-header-list" href="#concept-response-header-list">header list</a> excludes any
<a title="concept-header" href="#concept-header">headers</a> in
<a title="concept-internal-response" href="#concept-internal-response">internal response</a>'s
<a title="concept-response-header-list" href="#concept-response-header-list">header list</a> whose
<a title="concept-header-name" href="#concept-header-name">name</a> is a
<a href="#forbidden-response-header-name">forbidden response header name</a>.

<p>A <dfn title="concept-filtered-response-cors" id="concept-filtered-response-cors">CORS filtered response</dfn> is a
<a title="concept-filtered-response" href="#concept-filtered-response">filtered response</a> whose
<a title="concept-response-type" href="#concept-response-type">type</a> is "<code title="">cors</code>",
<a title="concept-response-header-list" href="#concept-response-header-list">header list</a> excludes all
<a title="concept-header" href="#concept-header">headers</a> in
<a title="concept-internal-response" href="#concept-internal-response">internal response</a>'s
<a title="concept-response-header-list" href="#concept-response-header-list">header list</a>, except those whose
<a title="concept-header-name" href="#concept-header-name">name</a> is either one of
`<code title="">Cache-Control</code>`, `<code title="">Content-Language</code>`,
`<code title="">Content-Type</code>`, `<code title="">Expires</code>`,
`<code title="">Last-Modified</code>`, and `<code title="">Pragma</code>`, and except those
whose <a title="concept-header-name" href="#concept-header-name">name</a> is both not a
<a href="#forbidden-response-header-name">forbidden response header name</a> and one of the
<a title="concept-header-value" href="#concept-header-value">values</a> resulting from
<a title="concept-header-parse" href="#concept-header-parse">parsing</a>
`<code title="http-access-control-expose-headers"><a href="#http-access-control-expose-headers">Access-Control-Expose-Headers</a></code>` in
<a title="concept-internal-response" href="#concept-internal-response">internal response</a>'s
<a title="concept-response-header-list" href="#concept-response-header-list">header list</a>.

<p>An <dfn title="concept-filtered-response-opaque" id="concept-filtered-response-opaque">opaque filtered response</dfn> is a
<a title="concept-filtered-response" href="#concept-filtered-response">filtered response</a> whose
<a title="concept-response-type" href="#concept-response-type">type</a> is "<code title="">opaque</code>",
<a title="concept-response-status" href="#concept-response-status">status</a> is <code title="">0</code>,
<a title="concept-response-status-message" href="#concept-response-status-message">status message</a> is the empty byte sequence,
<a title="concept-response-header-list" href="#concept-response-header-list">header list</a> is an empty list,
<a title="concept-response-body" href="#concept-response-body">body</a> is null, and
<a title="concept-response-cache-state" href="#concept-response-cache-state">cache state</a> is "<code title="">none</code>".

<p class="note no-backref">In other words, an
<a title="concept-filtered-response-opaque" href="#concept-filtered-response-opaque">opaque filtered response</a> is nearly
indistinguishable from a <a title="concept-network-error" href="#concept-network-error">network error</a>. When
introducing new APIs, do not use the
<a title="concept-internal-response" href="#concept-internal-response">internal response</a> for internal specification
algorithms as you will leak information.


<h3 id="authentication-entries"><span class="secno">2.2 </span>Authentication entries</h3>

<p>An <dfn id="authentication-entry">authentication entry</dfn> and a <dfn id="proxy-authentication-entry">proxy authentication entry</dfn> are
tuples of username, password, and realm, associated with one or more
<a title="concept-request" href="#concept-request">requests</a>.

<p>User agents should allow either to be cleared together with HTTP cookies and similar
tracking functionality.
<!-- fingerprinting -->

<p>Further details are defined by HTTP.
<a href="#refsHTTPAUTH">[HTTPAUTH]</a>



<h2 id="http-extensions"><span class="secno">3 </span>HTTP extensions</h2>

<h3 id="origin-header"><span class="secno">3.1 </span>`<code title="">Origin</code>` header</h3>

<p>The `<dfn title="http-origin" id="http-origin"><code>Origin</code></dfn>` request
<a title="concept-header" href="#concept-header">header</a> indicates where a
<a title="concept-fetch" href="#concept-fetch">fetch</a> originates from.

<p class="note no-backref">The `<code title="http-origin"><a href="#http-origin">Origin</a></code>` header is a version
of the `<code title="http-referer">Referer</code>` [sic] header that does not reveal a
<a title="concept-url-path" class="external" href="https://url.spec.whatwg.org/#concept-url-path">path</a>. It is used for
all <a title="concept-http-fetch" href="#concept-http-fetch">HTTP fetches</a> whose <i title="">CORS flag</i> is
set as well as those where <a title="concept-request" href="#concept-request">request</a>'s
<a title="concept-request-method" href="#concept-request-method">method</a> is `<code title="">POST</code>`. Due to
compatibility constraints it is not included in all
<a title="concept-fetch" href="#concept-fetch">fetches</a>.
<!-- Ian Hickson told me Adam Barth researched that -->

<p>Its <a title="concept-header-value" href="#concept-header-value">value</a> ABNF:

<pre>Origin                           = origin-or-null

origin-or-null                   = origin / %x6E.75.6C.6C ; "null", case-sensitive
origin                           = <a title="concept-url-scheme" class="external" href="https://url.spec.whatwg.org/#concept-url-scheme">scheme</a> "://" <a title="concept-url-host" class="external" href="https://url.spec.whatwg.org/#concept-url-host">host</a> [ ":" <a title="concept-url-port" class="external" href="https://url.spec.whatwg.org/#concept-url-port">port</a> ]</pre>

<p class="note no-backref">This supplants the `<code title="http-origin"><a href="#http-origin">Origin</a></code>`
<a title="concept-header" href="#concept-header">header</a>.
<a class="informative" href="#refsORIGIN">[ORIGIN]</a>


<h3 id="http-cors-protocol"><span class="secno">3.2 </span>CORS protocol</h3>

<p>To allow sharing resources cross-origin and allow for more versatile HTTP requests than
possible with HTML's <code class="external"><a href="https://html.spec.whatwg.org/multipage/forms.html#the-form-element">form</a></code> element, the platform has
a <dfn id="cors-protocol">CORS protocol</dfn> layered on top of HTTP. It allows resources to declare they
can be shared with resources residing on a different
<a class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#origin">origin</a>.

<p class="note">It needs to be an opt-in mechanism to prevent leaking data from resources
behind a firewall (intranets). Additionally, for credentialed HTTP requests it needs to be
opt-in to prevent leaking potentially-sensitive data.

<p>This section explains the <a href="#cors-protocol">CORS protocol</a> as it pertains to servers.
Requirements for user agents are part of the <a title="concept-fetch" href="#concept-fetch">fetch</a>
algorithm.

<h4 id="general"><span class="secno">3.2.1 </span>General</h4>

<p>The <a href="#cors-protocol">CORS protocol</a> consists of a set of headers that indicates whether a
particular resource can be shared cross-origin.

<p>For HTTP requests that are more involved than what is possible with HTML's
<code class="external"><a href="https://html.spec.whatwg.org/multipage/forms.html#the-form-element">form</a></code> element, a <a href="#cors-preflight-fetch-0">CORS preflight fetch</a> is
performed, to ensure the resource understands the <a href="#cors-protocol">CORS protocol</a>.


<h4 id="http-requests"><span class="secno">3.2.2 </span>HTTP requests</h4>

<p>An HTTP request can be identified as pertaining in the <a href="#cors-protocol">CORS protocol</a> if it
includes an `<code title="http-origin"><a href="#http-origin">Origin</a></code>` header. This is named a
<dfn id="cors-request">CORS request</dfn>.

<p>An HTTP request can be identified as being a check to see if the
<a href="#cors-protocol">CORS protocol</a> is understood if it is a <a href="#cors-request">CORS request</a>, uses
`<code title="">OPTIONS</code>` as <a title="concept-method" href="#concept-method">method</a>, and includes
these <a title="concept-header" href="#concept-header">headers</a>:

<dl>
 <dt>`<dfn title="http-access-control-request-method" id="http-access-control-request-method"><code>Access-Control-Request-Method</code></dfn>`
 <dd><p>Indicates which <a title="concept-method" href="#concept-method">method</a> a future
 <a href="#cors-request">CORS request</a> to the same resource might use.

 <dt>`<dfn title="http-access-control-request-headers" id="http-access-control-request-headers"><code>Access-Control-Request-Headers</code></dfn>`
 <dd><p>Indicates which <a title="concept-header" href="#concept-header">headers</a> a future
 <a href="#cors-request">CORS request</a> to the same resource might use.
</dl>

<p>This is named a <dfn id="cors-preflight-request">CORS preflight request</dfn>.


<h4 id="http-responses"><span class="secno">3.2.3 </span>HTTP responses</h4>

<p>An HTTP response to a <a href="#cors-request">CORS request</a> can include the following
<a title="concept-header" href="#concept-header">headers</a>:

<dl>
 <dt>`<dfn title="http-access-control-allow-origin" id="http-access-control-allow-origin"><code>Access-Control-Allow-Origin</code></dfn>`
 <dd><p>Indicates whether a resource can be shared, via returning the literal
 <a title="concept-header-value" href="#concept-header-value">value</a> of the
 `<code title="http-origin"><a href="#http-origin">Origin</a></code>` request <a title="concept-header" href="#concept-header">header</a>
 (which can be `<code title="">null</code>`) or `<code title="">*</code>` in a response.

 <dt>`<dfn title="http-access-control-allow-credentials" id="http-access-control-allow-credentials"><code>Access-Control-Allow-Credentials</code></dfn>`
 <dd>
  <p>Indicates whether a resource can be shared when
  <a title="concept-request" href="#concept-request">request</a>'s
  <a title="concept-request-credentials-mode" href="#concept-request-credentials-mode">credentials mode</a> is
  "<code title="">include</code>".

  <p class="note">For a <a href="#cors-preflight-request">CORS preflight request</a>,
  <a title="concept-request" href="#concept-request">request</a>'s
  <a title="concept-request-credentials-mode" href="#concept-request-credentials-mode">credentials mode</a> is always
  "<code title="">omit</code>", but for any subsequent
  <a title="CORS request" href="#cors-request">CORS requests</a> it might not be. Support therefore needs
  to be indicated as part of the HTTP response to the <a href="#cors-preflight-request">CORS preflight request</a>
  as well.
</dl>

<p>An HTTP response to a <a href="#cors-preflight-request">CORS preflight request</a> can include the following
<a title="concept-header" href="#concept-header">headers</a>:

<dl>
 <dt>`<dfn title="http-access-control-allow-methods" id="http-access-control-allow-methods"><code>Access-Control-Allow-Methods</code></dfn>`
 <dd>
  <p>Indicates which <a title="concept-method" href="#concept-method">methods</a> are supported by the
  resource for the purposes of the <a href="#cors-protocol">CORS protocol</a>.

  <p class="note">The `<code title="">Allow</code>` <a title="concept-header" href="#concept-header">header</a> is
  not relevant for the purposes of the <a href="#cors-protocol">CORS protocol</a>.

 <dt>`<dfn title="http-access-control-allow-headers" id="http-access-control-allow-headers"><code>Access-Control-Allow-Headers</code></dfn>`
 <dd><p>Indicates which <a title="concept-header" href="#concept-header">headers</a> are supported by the
 resource for the purposes of the <a href="#cors-protocol">CORS protocol</a>.

 <dt>`<dfn title="http-access-control-max-age" id="http-access-control-max-age"><code>Access-Control-Max-Age</code></dfn>`
 <dd><p>Indicates how long the information provided by the
 `<code title="http-access-control-allow-methods"><a href="#http-access-control-allow-methods">Access-Control-Allow-Methods</a></code>` and
 `<code title="http-access-control-allow-headers"><a href="#http-access-control-allow-headers">Access-Control-Allow-Headers</a></code>`
 <a title="concept-header" href="#concept-header">headers</a> can be cached.
</dl>

<p>An HTTP response to a <a href="#cors-request">CORS request</a> that is not a
<a href="#cors-preflight-request">CORS preflight request</a> can also include the following
<a title="concept-header" href="#concept-header">header</a>:

<dl>
 <dt>`<dfn title="http-access-control-expose-headers" id="http-access-control-expose-headers"><code>Access-Control-Expose-Headers</code></dfn>`
 <dd><p>Indicates which <a title="concept-header" href="#concept-header">headers</a> can be exposed as part
 of the HTTP response, via listing their <a title="concept-header-name" href="#concept-header-name">names</a>.
</dl>


<h4 id="http-new-header-syntax"><span class="secno">3.2.4 </span>HTTP new header syntax</h4>

<p>ABNF for the <a title="concept-header-value" href="#concept-header-value">values</a> of the
<a title="concept-header" href="#concept-header">headers</a> used by the <a href="#cors-protocol">CORS protocol</a>:

<pre>Access-Control-Request-Method    = <a class="external" href="http://tools.ietf.org/html/rfc2616/#section-5.1.1">Method</a>
Access-Control-Request-Headers   = #<a class="external" href="http://tools.ietf.org/html/rfc2616/#section-4.2">field-name</a>

Access-Control-Allow-Origin      = origin-or-null / "*"
Access-Control-Allow-Credentials = %x74.72.75.65 ; "true", case-sensitive
Access-Control-Expose-Headers    = #<a class="external" href="http://tools.ietf.org/html/rfc2616/#section-4.2">field-name</a>
Access-Control-Max-Age           = <a class="external" href="http://tools.ietf.org/html/rfc2616/#section-3.3.2">delta-seconds</a>
Access-Control-Allow-Methods     = #<a class="external" href="http://tools.ietf.org/html/rfc2616/#section-5.1.1">Method</a>
Access-Control-Allow-Headers     = #<a class="external" href="http://tools.ietf.org/html/rfc2616/#section-4.2">field-name</a></pre>



<h2 id="fetching"><span class="secno">4 </span>Fetching</h2>

<div class="note no-backref">
 <p>The algorithm below defines <a title="concept-fetch" href="#concept-fetch">fetching</a>. In broad
 strokes, it takes a <a title="concept-request" href="#concept-request">request</a> and outputs a
 <a title="concept-response" href="#concept-response">response</a>.

 <p>That is, it either returns a <a title="concept-response" href="#concept-response">response</a> if
 <a title="concept-request" href="#concept-request">request</a>'s <a href="#synchronous-flag">synchronous flag</a> is set, or it
 <a title="queue a fetch task" href="#queue-a-fetch-task">queues tasks</a> annotated
 <a href="#process-response">process response</a>, <a href="#process-response-body">process response body</a>, and
 <a href="#process-response-end-of-file">process response end-of-file</a> for the
 <a title="concept-response" href="#concept-response">response</a>.

 <p>To capture uploads, if <a title="concept-request" href="#concept-request">request</a>'s
 <a href="#synchronous-flag">synchronous flag</a> is unset,
 <a title="concept-task" class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task">tasks</a> annotated
 <a href="#process-request-body">process request body</a> and <a href="#process-request-end-of-file">process request end-of-file</a> for the
 <a title="concept-request" href="#concept-request">request</a> can be
 <a title="queue a fetch task" href="#queue-a-fetch-task">queued</a>.
</div>

<p>To perform a <dfn title="concept-fetch" id="concept-fetch">fetch</dfn> using <var title="">request</var>,
optionally with a <i title="">CORS flag</i>, run the steps below. An ongoing
<a title="concept-fetch" href="#concept-fetch">fetch</a> can be
<dfn title="concept-fetch-terminate" id="concept-fetch-terminate">terminated</dfn> with reason <var title="">reason</var>,
which must be one of <i title="">end-user abort</i>, <i title="">fatal</i>, or
<i title="">timeout</i>.

<p class="note no-backref">The <i title="">CORS flag</i> is a bookkeeping detail for handling
redirects. Only use the <var title="">request</var> parameter in other standards.

<ol>
 <li><p>Let <var title="">response</var> be null.

 <li><p>If <var title="">request</var>'s <a href="#local-urls-only-flag">local URLs only flag</a> is set and
 <var title="">request</var>'s <a title="concept-request-url" href="#concept-request-url">url</a> is not
 <a title="is local" class="external" href="https://url.spec.whatwg.org/#is-local">local</a>, set <var title="">response</var>
 to a <a title="concept-network-error" href="#concept-network-error">network error</a>.

 <li><p>If
 <a href="https://w3c.github.io/webappsec/specs/mixedcontent/#should-block-fetch">should fetching <var title="">request</var> be blocked as mixed content</a>
 or
 <span class="XXX">should fetching <var title="">request</var> be blocked as content security</span>
 returns <b title="">blocked</b>, set <var title="">response</var> to a
 <a title="concept-network-error" href="#concept-network-error">network error</a>.
 <a href="#refsMIX">[MIX]</a>
 <a href="#refsCSP">[CSP]</a>

 <li>
  <p>If <var title="">request</var>'s <a title="concept-request-referrer" href="#concept-request-referrer">referrer</a>
  is not <i title="">no referrer</i>, set <var title="">request</var>'s
  <a title="concept-request-referrer" href="#concept-request-referrer">referrer</a> to the result of invoking
  <a href="//w3c.github.io/webappsec/specs/referrer-policy/#determine-requests-referrer">determine <var title="">request</var>'s referrer</a>.
  <a href="#refsREFERRER">[REFERRER]</a>

  <p class="note no-backref">As stated in <cite>Referrer Policy</cite>, user agents can
  provide the end user with options to override <var title="">request</var>'s
  <a title="concept-request-referrer" href="#concept-request-referrer">referrer</a> to <i title="">no referrer</i> or have
  it expose less sensitive information.

 <li><p>If <var title="">request</var>'s <a title="concept-request-url" href="#concept-request-url">url</a> contains
 a Known HSTS Host, modify it per the requirements of the
 <a href="http://tools.ietf.org/html/rfc6797#section-8.3">"URI [sic] Loading and Port Mapping" chapter of HTTP Strict Transport Security</a>.
 <a href="#refsHSTS">[HSTS]</a>
 <!-- Per Mike West HSTS happens "probably after" Referrer -->

 <li><p>If <var title="">request</var>'s <a href="#synchronous-flag">synchronous flag</a> is unset and
 <a title="concept-fetch" href="#concept-fetch">fetch</a> is not invoked recursively, run the remaining
 steps <a class="external" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel">in parallel</a>.

 <li>
  <p>If <var title="">response</var> is null, set <var title="">response</var> to the value
  corresponding to the first matching statement:

  <dl class="switch">
   <dt><var title="">request</var>'s <a title="concept-request-url" href="#concept-request-url">url</a>'s
   <a title="concept-url-origin" class="external" href="https://url.spec.whatwg.org/#concept-url-origin">origin</a> is
   <var title="">request</var>'s <a title="concept-request-origin" href="#concept-request-origin">origin</a> and the
   <i title="">CORS flag</i> is unset
   <dt><var title="">request</var>'s <a title="concept-request-url" href="#concept-request-url">url</a>'s
   <a title="concept-url-scheme" class="external" href="https://url.spec.whatwg.org/#concept-url-scheme">scheme</a> is
   "<code title="">data</code>" and <var title="">request</var>'s
   <a href="#same-origin-data-url-flag">same-origin data URL flag</a> is set
   <dt><var title="">request</var>'s <a title="concept-request-url" href="#concept-request-url">url</a>'s
   <a title="concept-url-scheme" class="external" href="https://url.spec.whatwg.org/#concept-url-scheme">scheme</a> is
   "<code title="">about</code>"

   <dd><p>The result of performing a <a title="concept-basic-fetch" href="#concept-basic-fetch">basic fetch</a> using <var title="">request</var>.

   <dt><var title="">request</var>'s <a title="concept-request-mode" href="#concept-request-mode">mode</a> is
   "<code title="">same-origin</code>"

   <dd><p>A <a title="concept-network-error" href="#concept-network-error">network error</a>.

   <dt><var title="">request</var>'s <a title="concept-request-mode" href="#concept-request-mode">mode</a> is
   "<code title="">no-cors</code>"
   <dd>
    <p>Set <var title="">request</var>'s
    <a title="concept-request-response-tainting" href="#concept-request-response-tainting">response tainting</a> to
    "<code title="">opaque</code>".
    <p>The result of performing a <a title="concept-basic-fetch" href="#concept-basic-fetch">basic fetch</a> using
    <var title="">request</var>.
    <!-- file URLs end up here as they are not same-origin typically. -->

   <dt><var title="">request</var>'s <a title="concept-request-url" href="#concept-request-url">url</a>'s
   <a title="concept-url-scheme" class="external" href="https://url.spec.whatwg.org/#concept-url-scheme">scheme</a> is not one of
   "<code title="">http</code>" and "<code title="">https</code>"

   <dd><p>A <a title="concept-network-error" href="#concept-network-error">network error</a>.

   <dt><var title="">request</var>'s <a title="concept-request-mode" href="#concept-request-mode">mode</a> is
   "<code title="">cors-with-forced-preflight</code>"
   <dt><var title="">request</var>'s <a href="#unsafe-request-flag">unsafe request flag</a> is set and either
   <var title="">request</var>'s <a title="concept-request-method" href="#concept-request-method">method</a> is not
   a <a href="#simple-method">simple method</a> or a <a title="concept-header" href="#concept-header">header</a> in
   <var title="">request</var>'s <a title="concept-header-list" href="#concept-header-list">header list</a> is not a
   <a href="#simple-header">simple header</a>
   <dd>
    <p>Set <var title="">request</var>'s
    <a title="concept-request-response-tainting" href="#concept-request-response-tainting">response tainting</a> to
    "<code title="">cors</code>".
    <p>The result of performing an <a title="concept-http-fetch" href="#concept-http-fetch">HTTP fetch</a> using
    <var title="">request</var> with the <i title="">CORS flag</i> and
    <i title="">CORS preflight flag</i> set.

   <dt>Otherwise
   <dd>
    <p>Set <var title="">request</var>'s
    <a title="concept-request-response-tainting" href="#concept-request-response-tainting">response tainting</a> to
    "<code title="">cors</code>".
    <p>The result of performing an <a title="concept-http-fetch" href="#concept-http-fetch">HTTP fetch</a> using
    <var title="">request</var> with the <i title="">CORS flag</i> set.
  </dl>

 <li><p>If <a title="concept-fetch" href="#concept-fetch">fetch</a> is invoked recursively, return <var title="">response</var>.

 <li><p>If <var title="">response</var>'s
 <a title="concept-response-final-url-flag" href="#concept-response-final-url-flag">final url flag</a> is unset, set
 <var title="">response</var>'s <a title="concept-response-url" href="#concept-response-url">url</a> to
 <var title="">request</var>'s <a title="concept-request-url" href="#concept-request-url">url</a>.

 <li><p>If
 <a href="https://w3c.github.io/webappsec/specs/mixedcontent/#should-block-response">should <var title="">response</var> to <var title="">request</var> be blocked as mixed content</a>
 returns <b title="">blocked</b>, set <var title="">response</var> to a
 <a title="concept-network-error" href="#concept-network-error">network error</a>.
 <a href="#refsMIX">[MIX]</a>

 <li>
  <p>If <var title="">response</var> is not a
  <a title="concept-network-error" href="#concept-network-error">network error</a>, set <var title="">response</var> to
  the following <a title="concept-filtered-response" href="#concept-filtered-response">filtered response</a> with
  <var title="">response</var> as its
  <a title="concept-internal-response" href="#concept-internal-response">internal response</a>, depending on
  <var title="">request</var>'s
  <a title="concept-request-response-tainting" href="#concept-request-response-tainting">response tainting</a>:

  <dl class="switch compact">
   <dt>"<code title="">basic</code>"
   <dd><a title="concept-filtered-response-basic" href="#concept-filtered-response-basic">basic filtered response</a>
   <dt>"<code title="">cors</code>"
   <dd><a title="concept-filtered-response-cors" href="#concept-filtered-response-cors">CORS filtered response</a>
   <dt>"<code title="">opaque</code>"
   <dd><a title="concept-filtered-response-opaque" href="#concept-filtered-response-opaque">opaque filtered response</a>
  </dl>

 <li>
  <p>If <var title="">request</var>'s <a href="#synchronous-flag">synchronous flag</a> is set, wait for
  either end-of-file to have been pushed to
  <var title="">response</var>'s <a title="concept-response-body" href="#concept-response-body">body</a> or for
  <var title="">response</var> to have a
  <a title="concept-response-termination-reason" href="#concept-response-termination-reason">termination reason</a>, and then
  return <var title="">response</var>.

  <p class="note no-backref">This terminates <a title="concept-fetch" href="#concept-fetch">fetch</a>.

 <li><p>If <var title="">request</var>'s <a title="concept-request-body" href="#concept-request-body">body</a> is
 non-null and <var title="">request</var>'s <a title="concept-request-url" href="#concept-request-url">url</a>'s
 <a title="concept-url-scheme" class="external" href="https://url.spec.whatwg.org/#concept-url-scheme">scheme</a> is
 "<code title="">http</code>" or "<code title="">https</code>",
 <a href="#queue-a-fetch-task">queue a fetch task</a> on <var title="">request</var> to
 <dfn id="process-request-end-of-file">process request end-of-file</dfn> for <var title="">request</var>.

 <li><p><a href="#queue-a-fetch-task">Queue a fetch task</a> on <var title="">request</var> to
 <dfn id="process-response">process response</dfn> for <var title="">response</var>.

 <li>
  <p>If <var title="">response</var>'s
  <a title="concept-response-body" href="#concept-response-body">body</a> is null, run these substeps:

  <ol>
   <li><a href="#queue-a-fetch-task">Queue a fetch task</a> on <var title="">request</var> to
   <dfn id="process-response-body">process response body</dfn> for <var title="">response</var>.

   <li><p><a href="#queue-a-fetch-task">Queue a fetch task</a> on <var title="">request</var> to
   <dfn id="process-response-end-of-file">process response end-of-file</dfn> for <var title="">response</var>.
  </ol>

 <li>
  <p>Otherwise, if <var title="">response</var>'s
  <a title="concept-response-body" href="#concept-response-body">body</a> is non-null, run these substeps:

  <ol>
   <li><p>Whenever <var title="">response</var>'s
   <a title="concept-response-body" href="#concept-response-body">body</a>'s is pushed to, for and as long as
   <var title="">response</var> has no
   <a title="concept-response-termination-reason" href="#concept-response-termination-reason">termination reason</a> and
   end-of-file has not been pushed,
   <a href="#queue-a-fetch-task">queue a fetch task</a> on <var title="">request</var> to
   <a href="#process-response-body">process response body</a> for <var title="">response</var>.

   <li>
    <p>Once end-of-file has been pushed to <var title="">response</var>'s
    <a title="concept-response-body" href="#concept-response-body">body</a> or <var title="">response</var> has a
    <a title="concept-response-termination-reason" href="#concept-response-termination-reason">termination reason</a>,
    <a href="#queue-a-fetch-task">queue a fetch task</a> on <var title="">request</var> to
    <a href="#process-response-end-of-file">process response end-of-file</a> for <var title="">response</var>.

    <p class="note">Ideally FTP/HTTP define this in more detail and this becomes a set of
    simple hooks.
  </ol>

  <p>Use the <a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#networking-task-source">networking task source</a> for these
  <a title="concept-task" class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task">tasks</a>.
</ol>


<h3 id="basic-fetch"><span class="secno">4.1 </span>Basic fetch</h3>

<p>To perform a <dfn title="concept-basic-fetch" id="concept-basic-fetch">basic fetch</dfn> using
<var title="">request</var>, switch on <var title="">request</var>'s
<a title="concept-request-url" href="#concept-request-url">url</a>'s
<a title="concept-url-scheme" class="external" href="https://url.spec.whatwg.org/#concept-url-scheme">scheme</a>, and run the associated
steps:

<dl class="switch">
 <dt>"<code title="">about</code>"
 <dd>
  <p>If <var title="">request</var>'s <a title="concept-request-url" href="#concept-request-url">url</a>'s
  <a title="concept-url-scheme-data" class="external" href="https://url.spec.whatwg.org/#concept-url-scheme-data">scheme data</a> is
  "<code title="">blank</code>", return a <a title="concept-response" href="#concept-response">response</a> whose
  <a title="concept-response-header-list" href="#concept-response-header-list">header list</a> consist of a single
  <a title="concept-header" href="#concept-header">header</a> whose
  <a title="concept-header-name" href="#concept-header-name">name</a> is `<code title="">Content-Type</code>` and
  <a title="concept-header-value" href="#concept-header-value">value</a> is
  `<code title="">text/html;charset=utf-8</code>`,
  <a title="concept-response-body" href="#concept-response-body">body</a> is the empty byte sequence, and
  <a title="concept-response-tls-state" href="#concept-response-tls-state">TLS state</a> is <var title="">request</var>'s
  <a title="concept-request-client" href="#concept-request-client">client</a>'s <span>TLS state</span>.
  <!-- XXX xref TLS state -->

  <!-- introduce about:unicorn
       https://html5.org/temp/unicorn.svg -->

  <p>Otherwise, return a <a title="concept-network-error" href="#concept-network-error">network error</a>.

  <p class="note no-backref"><a title="concept-url" class="external" href="https://url.spec.whatwg.org/#concept-url">URLs</a> such
  as "<code title="">about:config</code>" are handled during
  <a title="navigate" class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#navigate">navigation</a> and result in a
  <a title="concept-network-error" href="#concept-network-error">network error</a> in the context of
  <a title="concept-fetch" href="#concept-fetch">fetching</a>.

 <dt>"<code title="">blob</code>"
 <dd>
  <ol>
   <li><p>Let <var title="">blob</var> be <var title="">request</var>'s
   <a title="concept-request-url" href="#concept-request-url">url</a>'s
   <a title="concept-url-object" class="external" href="https://url.spec.whatwg.org/#concept-url-object">object</a>.

   <li><p>If <var title="">blob</var> is null, return a
   <a title="concept-network-error" href="#concept-network-error">network error</a>.

   <li><p>Let <var title="">response</var> be a new
   <a title="concept-response" href="#concept-response">response</a>.

   <li><p><a title="concept-header-list-append" href="#concept-header-list-append">Append</a>
   `<code title="">Content-Length</code>`/<var title="">blob</var>'s
   <code title="dom-Blob-size" class="external"><a href="http://dev.w3.org/2006/webapi/FileAPI/#dfn-size">size</a></code> attribute value to
   <var title="">response</var>'s
   <a title="concept-response-header-list" href="#concept-response-header-list">header list</a>.

   <li><p><a title="concept-header-list-append" href="#concept-header-list-append">Append</a>
   `<code title="">Content-Type</code>`/<var title="">blob</var>'s
   <code title="dom-Blob-type" class="external"><a href="http://dev.w3.org/2006/webapi/FileAPI/#dfn-type">type</a></code> attribute value to
   <var title="">response</var>'s
   <a title="concept-response-header-list" href="#concept-response-header-list">header list</a>.

   <li><p>Set <var title="">response</var>'s
   <a title="concept-response-tls-state" href="#concept-response-tls-state">TLS state</a> to <var title="">request</var>'s
   <a title="concept-request-client" href="#concept-request-client">client</a>'s <span>TLS state</span>.
   <!-- XXX xref TLS state -->

   <li><p>Set <var title="">response</var>'s <a title="concept-response-body" href="#concept-response-body">body</a> to
   the result of performing the <a class="external" href="http://dev.w3.org/2006/webapi/FileAPI/#readOperation">read operation</a> on
   <var title="">blob</var>.
   <!-- This takes care of setting length, transmitted, and error flag as well -->

   <li><p>Return <var title="">response</var>.
  </ol>

 <dt>"<code title="">data</code>"
 <dd>
  <p>If <var title="">request</var>'s <a title="concept-request-method" href="#concept-request-method">method</a> is
  `<code title="">GET</code>` and
  <a href="http://simonsapin.github.io/data-urls/">obtaining a resource</a> from
  <var title="">request</var>'s <a title="concept-request-url" href="#concept-request-url">url</a> does not return
  failure, return a <a title="concept-response" href="#concept-response">response</a> whose
  <a title="concept-response-header-list" href="#concept-response-header-list">header list</a> consist of a single
  <a title="concept-header" href="#concept-header">header</a> whose
  <a title="concept-header-name" href="#concept-header-name">name</a> is `<code title="">Content-Type</code>` and
  <a title="concept-header-value" href="#concept-header-value">value</a> is the MIME type and parameters returned
  from <a href="http://simonsapin.github.io/data-urls/">obtaining a resource</a>,
  <a title="concept-response-body" href="#concept-response-body">body</a> is the data returned from
  <a href="http://simonsapin.github.io/data-urls/">obtaining a resource</a>, and
  <a title="concept-response-tls-state" href="#concept-response-tls-state">TLS state</a> is <var title="">request</var>'s
  <a title="concept-request-client" href="#concept-request-client">client</a>'s <span>TLS state</span>.
  <!-- XXX xref TLS state -->
  <a href="#refsDATAURL">[DATAURL]</a>
  <!-- XXX "obtaining a resource" needs a better reference -->

  <p>Otherwise, return a <a title="concept-network-error" href="#concept-network-error">network error</a>.

 <dt>"<code title="">file</code>"
 <dt>"<code title="">ftp</code>"
 <dd>
  <p>For now, unfortunate as it is, <code title="">file</code> and <code title="">ftp</code>
  <a title="concept-url" class="external" href="https://url.spec.whatwg.org/#concept-url">URLs</a> are left as an exercise for the
  reader.

  <p>When in doubt, return a <a title="concept-network-error" href="#concept-network-error">network error</a>.

 <dt>"<code title="">filesystem</code>"</dt> <!-- flag below also applies to "indexeddb" -->
 <dd>
  <p>If <var title="">request</var>'s <a href="#sandboxed-storage-area-urls-flag">sandboxed storage area URLs flag</a> is set,
  return a <a title="concept-network-error" href="#concept-network-error">network error</a>.

  <p class="XXX">Otherwise, … this scheme still needs to be defined.

 <dt>"<code title="">http</code>"
 <dt>"<code title="">https</code>"
 <dd>
  <p>Return the result of performing an <a title="concept-http-fetch" href="#concept-http-fetch">HTTP fetch</a>
  using <var title="">request</var>.

 <dt>Otherwise
 <dd><p>Return a <a title="concept-network-error" href="#concept-network-error">network error</a>.
</dl>


<h3 id="http-fetch"><span class="secno">4.2 </span>HTTP fetch</h3>

<p>To perform an <dfn title="concept-http-fetch" id="concept-http-fetch">HTTP fetch</dfn> using
<var title="">request</var> with an optional <i title="">CORS flag</i>,
<i title="">CORS preflight flag</i>, and <i title="">authentication fetch flag</i>, run these
steps:

<p class="note no-backref">The <i title="">CORS flag</i> is still a bookkeeping detail. The
<i title="">CORS preflight flag</i> and <i title="">authentication fetch flag</i> are too. The
former indicates a <a href="#cors-preflight-request">CORS preflight request</a> is required and the latter
indicates an attempt to authenticate.

<ol>
 <li><p>Let <var title="">response</var> be null.

 <li>
  <p>If <var title="">request</var>'s <a href="#skip-service-worker-flag">skip service worker flag</a> is unset and
  <var title="">request</var>'s <a title="concept-request-client" href="#concept-request-client">client</a>'s
  <a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#global-object">global object</a> is not a
  <code class="external"><a href="https://slightlyoff.github.io/ServiceWorker/spec/service_worker/#service-worker-global-scope-interface">ServiceWorkerGlobalScope</a></code> object, run these substeps:
  <a href="#refsHTML">[HTML]</a>
  <a href="#refsSW">[SW]</a>

  <ol>
   <li><p>Set <var title="">response</var> to the result of invoking
   <a class="external" href="https://slightlyoff.github.io/ServiceWorker/spec/service_worker/#on-fetch-request-algorithm">handle fetch</a> for <var title="">request</var>.
   <a href="#refsSW">[SW]</a>

   <li><p>If either <var title="">response</var>'s
   <a title="concept-response-type" href="#concept-response-type">type</a> is "<code title="">opaque</code>" and
   <var title="">request</var>'s <a title="concept-request-mode" href="#concept-request-mode">mode</a> is not
   "<code title="">no-cors</code>" or <var title="">response</var>'s
   <a title="concept-response-type" href="#concept-response-type">type</a> is <i title="">error</i>, return a
   <a title="concept-network-error" href="#concept-network-error">network error</a>.
  </ol>

 <li>
  <p>If <var title="">response</var> is null, run these substeps:

  <ol>
   <li>
    <p>If the <i title="">CORS preflight flag</i> is set and one of these conditions is true:

    <ul>
     <li>There is no <a title="concept-cache-match-method" href="#concept-cache-match-method">method cache match</a> for
     <var title="">request</var>'s <a title="concept-request-method" href="#concept-request-method">method</a> using
     <var title="">request</var>, and either <var title="">request</var>'s
     <a title="concept-request-method" href="#concept-request-method">method</a> is a not <a href="#simple-method">simple method</a>
     or <var title="">request</var>'s <a title="concept-request-mode" href="#concept-request-mode">mode</a> is
     "<code title="">cors-with-forced-preflight</code>".

     <li>There is at least one <a title="concept-header" href="#concept-header">header</a> in
     <var title="">request</var>'s <a title="concept-request-header-list" href="#concept-request-header-list">header list</a>
     for whose <a title="concept-header-name" href="#concept-header-name">name</a> there is no
     <a title="concept-cache-match-header" href="#concept-cache-match-header">header name cache match</a> using
     <var title="">request</var> and which is not a <a href="#simple-header">simple header</a>.
    </ul>

    <p>Then run these subsubsteps:

    <ol>
     <li><p>Let <var title="">response</var> be the result of performing a
     <a href="#cors-preflight-fetch-0">CORS preflight fetch</a> using <var title="">request</var>.

     <li><p>If <var title="">response</var> is a
     <a title="concept-network-error" href="#concept-network-error">network error</a>, return
     <var title="">response</var>.
    </ol>

   <li>
    <p>Set <var title="">request</var>'s <a href="#skip-service-worker-flag">skip service worker flag</a>.

    <p class="note no-backref">There might be redirects. Alternatively,
    <var title="">request</var>'s <a href="#authentication-flag">authentication flag</a> is set and the
    <i title="">CORS flag</i> is unset.

   <li><p>Let <var title="">credentials flag</var> be set if either
   <var title="">request</var>'s
   <a title="concept-request-credentials-mode" href="#concept-request-credentials-mode">credentials mode</a> is
   "<code title="">include</code>", or <var title="">request</var>'s
   <a title="concept-request-credentials-mode" href="#concept-request-credentials-mode">credentials mode</a> is
   "<code title="">same-origin</code>" and the <i title="">CORS flag</i> is unset, and unset otherwise.

   <li><p>If <var title="">request</var>'s
   <a title="concept-request-cache-mode" href="#concept-request-cache-mode">cache mode</a> is "<code title="">default</code>" and
   <var title="">request</var>'s <a title="concept-request-header-list" href="#concept-request-header-list">header list</a>
   contains a <a title="concept-header" href="#concept-header">header</a>
   <span title="concept-header-named">named</span>
   `<code title="">If-Modified-Since</code>`,
   `<code title="">If-None-Match</code>`,
   `<code title="">If-Unmodified-Since</code>`,
   `<code title="">If-Match</code>`, or
   `<code title="">If-Range</code>`, set <var title="">request</var>'s
   <a title="concept-request-cache-mode" href="#concept-request-cache-mode">cache mode</a> to "<code title="">no-store</code>".

   <li><p>Set <var title="">response</var> to the result of performing an
   <a title="concept-http-network-or-cache-fetch" href="#concept-http-network-or-cache-fetch">HTTP network or cache fetch</a>
   using <var title="">request</var> with <var title="">credentials flag</var> if set and
   <i title="">authentication fetch flag</i> if set.

   <li>
    <p>If the <i title="">CORS flag</i> is set and a
    <a title="concept-cors-check" href="#concept-cors-check">CORS check</a> for <var title="">request</var> and
    <var title="">response</var> returns failure, return a
    <a title="concept-network-error" href="#concept-network-error">network error</a>.

    <p class="note">There is no need to apply this to a
    <a title="concept-response" href="#concept-response">response</a> from a service worker.
  </ol>

 <li>
  <p>Then, switch on <var title="">response</var>'s
  <a title="concept-response-status" href="#concept-response-status">status</a>:

  <dl class="switch">
   <dt><code title="">304</code>
   <dd>
    <ol>
     <li><p>If <var title="">request</var>'s
     <a title="concept-request-cache-mode" href="#concept-request-cache-mode">cache mode</a> is neither
     "<code title="">default</code>" nor "<code title="">no-cache</code>", do nothing.

     <li>
      <p>Otherwise, run these subsubsteps:

      <ol>
       <li><p>If there is no entry in the HTTP cache for <var title="">request</var> and
       <var title="">response</var>, return a
       <a title="concept-network-error" href="#concept-network-error">network error</a>.
       <!-- XXX xref "HTTP cache" -->

       <li>
        <p>Set <var title="">response</var> to the result of obtaining a
        <a title="concept-response" href="#concept-response">response</a> from the HTTP cache using
        <var title="">request</var> and <var title="">response</var>.
        <!-- XXX xref "HTTP cache" -->

        <p class="note no-backref">This changes <var title="">response</var> entirely,
        including its <a title="concept-response-status" href="#concept-response-status">status</a> which is most
        likely <code title="">200</code> now.

        <p>Set <var title="">response</var>'s
        <a title="concept-response-cache-state" href="#concept-response-cache-state">cache state</a> to
        <i title="">validated</i>.
      </ol>
    </ol>

   <dt><code title="">301</code>
   <dt><code title="">302</code>
   <dt><code title="">303</code>
   <dt><code title="">307</code>
   <dt><code title="">308</code>
   <dd>
    <ol>
     <li>
      <p>Let <var title="">location</var> be the result of
      <a title="concept-header-parse" href="#concept-header-parse">parsing</a> `<code title="">Location</code>` in
      <var title="">response</var>'s
      <a title="concept-response-header-list" href="#concept-response-header-list">header list</a>.

     <li><p>If <var title="">location</var> is null, return <var title="">response</var>.

     <li><p>If <var title="">location</var> is failure, return a
     <a title="concept-network-error" href="#concept-network-error">network error</a>.
     <!-- only Gecko does this; and even that is currently more complicated -->

     <li><p>Let <var title="">locationURL</var> be the result of
     <a title="concept-url-parser" class="external" href="https://url.spec.whatwg.org/#concept-url-parser">parsing</a>
     <var title="">location</var> with <var title="">request</var>'s
     <a title="concept-request-url" href="#concept-request-url">url</a>.

     <li><p>If <var title="">locationURL</var> is failure, return a
     <a title="concept-network-error" href="#concept-network-error">network error</a>.

     <li><p>If <var title="">request</var>'s
     <a title="concept-request-redirect-count" href="#concept-request-redirect-count">redirect count</a> is twenty, return a
     <a title="concept-network-error" href="#concept-network-error">network error</a>.

     <li><p>Increase <var title="">request</var>'s
     <a title="concept-request-redirect-count" href="#concept-request-redirect-count">redirect count</a> by one.

     <li><p>Unset <var title="">request</var>'s <a href="#same-origin-data-url-flag">same-origin data URL flag</a>.

     <li><p>If the <i title="">CORS preflight flag</i> is set, set
     <var title="">response</var>'s <a title="concept-response-type" href="#concept-response-type">type</a> to
     <i title="">error</i> and set <var title="">request</var>'s
     <a title="concept-request-manual-redirect-flag" href="#concept-request-manual-redirect-flag">manual redirect flag</a>.
     <span class="note">This way we avoid running the substeps below.</span>

     <li>
      <p>If <var title="">request</var>'s
      <a title="concept-request-manual-redirect-flag" href="#concept-request-manual-redirect-flag">manual redirect flag</a> is unset,
      run these substeps:

      <ol>
       <li><p>If the <i title="">CORS flag</i> is set and <var title="">locationURL</var>'s
       <a title="concept-url-origin" class="external" href="https://url.spec.whatwg.org/#concept-url-origin">origin</a> is not
       <var title="">request</var>'s <a title="concept-request-url" href="#concept-request-url">url</a>'s
       <span title="concept-url-origin" data-analis-spec="url">origin</span>, set
       <var title="">request</var>'s <a title="concept-request-origin" href="#concept-request-origin">origin</a> to an
       opaque identifier.

       <li><p>If the <i title="">CORS flag</i> is set and either
       <var title="">locationURL</var>'s
       <a title="concept-url-username" class="external" href="https://url.spec.whatwg.org/#concept-url-username">username</a> is not the
       empty string or <var title="">locationURL</var>'s
       <a title="concept-url-password" class="external" href="https://url.spec.whatwg.org/#concept-url-password">password</a> is non-null,
       return a <a title="concept-network-error" href="#concept-network-error">network error</a>.

       <li><p>Set <var title="">request</var>'s <a title="concept-request-url" href="#concept-request-url">url</a> to
       <var title="">locationURL</var>.

       <li><p>Return the result of performing a <a title="concept-fetch" href="#concept-fetch">fetch</a> using
       <var title="">request</var>, with the <i title="">CORS flag</i> set if set.
       <!-- Unfortunately this has to invoke fetch to get response tainting correct -->
      </ol>
    </ol>

   <dt><code title="">401</code>
   <dd>
    <ol>
     <li><p>If <var title="">request</var>'s <a href="#authentication-flag">authentication flag</a> is unset or the
     <i title="">CORS flag</i> is set, return <var title="">response</var>.

     <li class="XXX"><p>Needs testing: multiple `<code>WWW-Authenticate</code>` headers,
     missing, parsing issues.

     <li>
      <p>If <var title="">request</var>'s
      <a title="concept-request-use-url-credentials-flag" href="#concept-request-use-url-credentials-flag">use URL credentials flag</a>
      is unset, or the <i title="">authentication fetch flag</i> is set, run these substeps:

      <ol>
       <li><p>Let <var title="">username</var> and <var title="">password</var> be the result of
       prompting the end user for a username and password, respectively.

       <li><p><a class="external" href="https://url.spec.whatwg.org/#set-the-username">Set the username</a> given
       <var title="">request</var>'s <a title="concept-request-url" href="#concept-request-url">url</a> and
       <var title="">username</var>.

       <li><p><a class="external" href="https://url.spec.whatwg.org/#set-the-password">Set the password</a> given
       <var title="">request</var>'s <a title="concept-request-url" href="#concept-request-url">url</a> and
       <var title="">password</var>.
      </ol>

     <li><p>Return the result of performing an
     <a title="concept-http-fetch" href="#concept-http-fetch">HTTP fetch</a> using <var title="">request</var>, with
     the <i title="">authentication fetch flag</i> set.
     <!-- cannot invoke >HTTP network or cache fetch< as that would not come back here -->
    </ol>

   <dt><code title="">407</code>
   <dd>
    <ol>
     <li class="XXX"><p>Needs testing: multiple `<code>Proxy-Authenticate</code>` headers,
     missing, parsing issues.

     <li>
      <p>Prompt the end user as appropriate and store the result as appropriate as a
      <a href="#proxy-authentication-entry">proxy authentication entry</a>.
      <a href="#refsHTTP">[HTTP]</a>

      <p class="note">Remaining details surrounding proxy authentication are defined by HTTP.

     <li><p>Return the result of performing an
     <a title="concept-http-fetch" href="#concept-http-fetch">HTTP fetch</a> using <var title="">request</var>.
     <!-- cannot invoke >HTTP network or cache fetch< as that would not come back here -->
    </ol>

   <dt>Otherwise
   <dd><p>Do nothing.
  </dl>

 <li><p>If the <i title="">authentication fetch flag</i> is set, create an
 <a href="#authentication-entry">authentication entry</a> for <var title="">request</var> and the given realm.
 <a href="#refsHTTPAUTH">[HTTPAUTH]</a>

 <li><p>If the <i title="">CORS preflight flag</i> is set and <var title="">response</var> is a
 <a title="concept-network-error" href="#concept-network-error">network error</a>,
 <a title="concept-cache-clear" href="#concept-cache-clear">clear cache entries</a> using
 <var title="">request</var>.

 <li><p>Return <var title="">response</var>. <span class="note no-backref">Typically
 <var title="">response</var>'s <a title="concept-response-body" href="#concept-response-body">body</a> is still being
 pushed to after returning.</span>
</ol>


<h3 id="http-network-or-cache-fetch"><span class="secno">4.3 </span>HTTP network or cache fetch</h3>

<p>To perform an
<dfn title="concept-http-network-or-cache-fetch" id="concept-http-network-or-cache-fetch">HTTP network or cache fetch</dfn> using
<var title="">request</var> with an optional <i title="">credentials flag</i> and
<i title="">authentication fetch flag</i>, run these steps:

<p class="note">The <i title="">authentication fetch flag</i> is still a bookkeeping detail.
The <i title="">credentials flag</i> is one too.

<ol>
 <li>
  <p>Let <var title="">HTTPRequest</var> be a copy of <var title="">request</var>, except that
  <var title="">HTTPRequest</var>'s <a title="concept-request-body" href="#concept-request-body">body</a> is a tee of
  <var title="">request</var>'s <a title="concept-request-body" href="#concept-request-body">body</a>.

  <p class="note no-backref"><a title="concept-header" href="#concept-header">Headers</a> need to be added
  without affecting <var title="">request</var>. Due to redirects or authentication failure,
  it can get reused.

 <li><p><a title="concept-header-list-append" href="#concept-header-list-append">Append</a>
 `<code title="">Referer</code>`/empty byte sequence, if <var title="">HTTPRequest</var>'s
 <a title="concept-request-referrer" href="#concept-request-referrer">referrer</a> is <i title="">no referrer</i>, and
 `<code title="">Referer</code>`/<var title="">HTTPRequest</var>'s
 <a title="concept-request-referrer" href="#concept-request-referrer">referrer</a>,
 <a title="concept-url-serializer" class="external" href="https://url.spec.whatwg.org/#concept-url-serializer">serialized</a> and
 <a title="utf-8 encode" class="external" href="https://encoding.spec.whatwg.org/#utf-8-encode">utf-8 encoded</a>, otherwise, to
 <var title="">HTTPRequest</var>'s
 <a title="concept-request-header-list" href="#concept-request-header-list">header list</a>.
 <!-- XXX ideally we have an easier way to convert something ASCII-safe into bytes
          concept-as-bytes -->

 <li><p>If <var title="">HTTPRequest</var>'s
 <a href="#force-origin-header-flag">force <code>Origin</code> header flag</a> is set,
 <a title="concept-header-list-append" href="#concept-header-list-append">append</a>
 `<code title="">Origin</code>`/<var title="">HTTPRequest</var>'s
 <a title="concept-request-origin" href="#concept-request-origin">origin</a>,
 <a title="ASCII serialization of an origin" class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin">serialized</a>
 and <a title="utf-8 encode" class="external" href="https://encoding.spec.whatwg.org/#utf-8-encode">utf-8 encoded</a>, to
 <var title="">HTTPRequest</var>'s
 <a title="concept-request-header-list" href="#concept-request-header-list">header list</a>.
 <!-- XXX concept-as-bytes -->

 <li>
  <p>If <var title="">credentials flag</var> is set, run these substeps:

  <ol>
   <li><p>Modify <var title="">HTTPRequest</var>'s
   <a title="concept-request-header-list" href="#concept-request-header-list">header list</a>
   per HTTP State Management Mechanism.
   <a href="#refsCOOKIES">[COOKIES]</a>
   <!-- XXX proper hook? -->

   <!-- https://wiki.whatwg.org/wiki/HTTP_Authentication -->
   <li><p>Let <var title="">authorizationValue</var> be null.

   <li><p>If there's an <a href="#authentication-entry">authentication entry</a> for <var title="">HTTPRequest</var>
   and either <var title="">HTTPRequest</var>'s
   <a title="concept-request-use-url-credentials-flag" href="#concept-request-use-url-credentials-flag">use URL credentials flag</a> is
   unset or <var title="">HTTPRequest</var>'s <a title="concept-request-url" href="#concept-request-url">url</a> does
   not <a class="external" href="https://url.spec.whatwg.org/#include-credentials">include credentials</a>, set
   <var title="">authorizationValue</var> to <a href="#authentication-entry">authentication entry</a>.
   <!-- need to define the cache concept -->

   <li><p>Otherwise, if <var title="">HTTPRequest</var>'s
   <a title="concept-request-url" href="#concept-request-url">url</a> does
   <a class="external" href="https://url.spec.whatwg.org/#include-credentials">include credentials</a> and the
   <i title="">authentication fetch flag</i> is set, set
   <var title="">authorizationValue</var> to <var title="">HTTPRequest</var>'s
   <a title="concept-request-url" href="#concept-request-url">url</a>,
   <span class="XXX">converted to an `<code title="">Authorization</code>` value</span>.

   <li><p>If <var title="">authorizationValue</var> is non-null,
   <a title="concept-header-list-append" href="#concept-header-list-append">append</a>
   `<code title="">Authorization</code>`/<var title="">authorizationValue</var> to
   <var title="">HTTPRequest</var>'s
   <a title="concept-request-header-list" href="#concept-request-header-list">header list</a>.
  </ol>

 <li>
  <p>If there's a <a href="#proxy-authentication-entry">proxy authentication entry</a>, use it as appropriate.

  <p class="note no-backref">This intentionally does not depend on
  <var title="">HTTPRequest</var>'s
  <a title="concept-request-credentials-mode" href="#concept-request-credentials-mode">credentials mode</a>.

 <li><p>Let <var title="">response</var> be null.

 <li>
  <p>If <var title="">request</var>'s
  <a title="concept-request-cache-mode" href="#concept-request-cache-mode">cache mode</a> is neither
  "<code title="">no-store</code>" nor "<code title="">reload</code>", and there is a <em>complete</em>
  <a title="concept-response" href="#concept-response">response</a> in the HTTP cache for
  <var title="">request</var> run these substeps:
  <!-- XXX xref "HTTP cache" -->

  <ol>
   <li><p>If <var title="">request</var>'s
   <a title="concept-request-cache-mode" href="#concept-request-cache-mode">cache mode</a> is either
   "<code title="">force-cache</code>" or "<code title="">only-if-cached</code>", set <var title="">response</var>
   to the <a title="concept-response" href="#concept-response">response</a> in the HTTP cache for
   <var title="">request</var>.

   <li><p>Otherwise, if <var title="">request</var>'s
   <a title="concept-request-cache-mode" href="#concept-request-cache-mode">cache mode</a> is "<code title="">default</code>" and
   the <a title="concept-response" href="#concept-response">response</a> in the HTTP cache for
   <var title="">request</var> does not require revalidation, set <var title="">response</var>
   to that <a title="concept-response" href="#concept-response">response</a> and set
   <var title="">response</var>'s <a title="concept-response-cache-state" href="#concept-response-cache-state">cache state</a>
   to <i title="">local</i>.
   <!-- XXX xref "revalidation" -->

   <li><p>Otherwise, if <var title="">request</var>'s
   <a title="concept-request-cache-mode" href="#concept-request-cache-mode">cache mode</a> is either "<code title="">default</code>"
   or "<code title="">no-cache</code>", and the <a title="concept-response" href="#concept-response">response</a> in the
   HTTP cache for <var title="">request</var> does require revalidation, modify
   <var title="">HTTPRequest</var>'s
   <a title="concept-request-header-list" href="#concept-request-header-list">header list</a> with revalidation
   <a title="concept-header" href="#concept-header">headers</a>.
   <!-- XXX modify, revalidation headers -->
  </ol>

 <li><p>Otherwise, if <var title="">request</var>'s
 <a title="concept-request-cache-mode" href="#concept-request-cache-mode">cache mode</a> is either "<code title="">default</code>"
 or "<code title="">force-cache</code>", and there is a <em>partial</em>
 <a title="concept-response" href="#concept-response">response</a> in the HTTP cache for
 <var title="">request</var>, modify <var title="">HTTPRequest</var>'s
 <a title="concept-request-header-list" href="#concept-request-header-list">header list</a> with resume
 <a title="concept-header" href="#concept-header">headers</a>.
 <!-- XXX xref partial, modify, resume headers -->

 <li>If <var title="">response</var> is null and <var title="">request</var>'s
 <a title="concept-request-cache-mode" href="#concept-request-cache-mode">cache mode</a> is "<code title="">only-if-cached</code>",
 return a <a title="concept-network-error" href="#concept-network-error">network error</a>.

 <li>
  <p>If <var title="">response</var> is null, modify <var title="">HTTPRequest</var>'s
  <a title="concept-request-header-list" href="#concept-request-header-list">header list</a> per HTTP.

  <p class="note no-backref">It would be great if we could make this more normative
  somehow. At this point <a title="concept-header" href="#concept-header">headers</a> such as
  `<code title="http-accept-encoding">Accept-Encoding</code>`,
  `<code title="http-connection">Connection</code>`,
  `<code title="http-dnt">DNT</code>`, and
  `<code title="http-host">Host</code>`,
  are to be <a title="concept-header-list-append" href="#concept-header-list-append">appended</a> if necessary.

  <p>`<code title="http-accept-charset">Accept-Charset</code>` must not be included.
  `<code title="http-accept">Accept</code>` and
  `<code title="http-accept-language">Accept-Language</code>` must not be included at this
  point. <span class="note">See <a href="#http-header-layer-division">HTTP header layer division</a>.</span>

 <li>
  <p>If <var title="">response</var> is null, set <var title="">response</var> to the result of
  making an <a title="concept-http-network-fetch" href="#concept-http-network-fetch">HTTP network fetch</a> using
  <var title="">HTTPRequest</var> with the <i title="">credentials flag</i> set if set.

 <li><p>Return <var title="">response</var>. <span class="note no-backref">Typically
 <var title="">response</var>'s <a title="concept-response-body" href="#concept-response-body">body</a> is still being
 pushed to after returning.</span>
</ol>


<h3 id="http-network-fetch"><span class="secno">4.4 </span>HTTP network fetch</h3>

<p>To perform an <dfn title="concept-http-network-fetch" id="concept-http-network-fetch">HTTP network fetch</dfn> using
<var title="">request</var> with an optional <i title="">credentials flag</i>, run these steps:

<ol>
 <li>
  <p>Let <var title="">response</var> be the result of making an HTTP request using
  <var title="">HTTPRequest</var>, following the requirements
  from HTTP, and waiting until either all the <a title="concept-header" href="#concept-header">headers</a>
  are transmitted or a <a title="concept-network-error" href="#concept-network-error">network error</a> was
  returned. If a <a title="concept-network-error" href="#concept-network-error">network error</a> was returned due
  to <a title="concept-fetch" href="#concept-fetch">fetch</a> being
  <a title="concept-fetch-terminate" href="#concept-fetch-terminate">terminated</a> with reason
  <var title="">reason</var>, set <var title="">response</var>'s
  <a title="concept-response-termination-reason" href="#concept-response-termination-reason">termination reason</a> to
  <var title="">reason</var>.
  <a href="#refsHTTP">[HTTP]</a>

  <p>HTTP requests should be grouped based on the <i title="">credentials flag</i>.
  HTTP requests with the <i title="">credentials flag</i> set should not share anything about
  the connection or TLS particulars (such as session identifiers) with HTTP requests that
  have the <i title="">credentials flag</i> unset. In other words, ambient authority should
  not leak across this grouping.
  <!-- XXX https://www.w3.org/Bugs/Public/show_bug.cgi?id=26556 -->

  <p>If <var title="">response</var> was retrieved over TLS, set its
  <a title="concept-response-tls-state" href="#concept-response-tls-state">TLS state</a> to either
  <i title="">deprecated authentication</i> or <i title="">authenticated</i>.
  <a href="#refsTLS">[TLS]</a>

  <p class="note">The exact determination here is up to user agents for the time being.
  User agents are strongly encouraged to only succeed TLS connections with strong security
  properties and return <a title="concept-network-error" href="#concept-network-error">network errors</a> otherwise.

  <p>If <var title="">HTTPRequest</var>'s <a title="concept-request-body" href="#concept-request-body">body</a> is
  non-null, run these substeps:

  <ol>
   <li><p>If <var title="">HTTPRequest</var>'s
   <a title="concept-request-body" href="#concept-request-body">body</a>'s payload body length is known, set
   <var title="">HTTPRequest</var>'s <a title="concept-request-body" href="#concept-request-body">body</a>'s
   <a title="concept-body-length" href="#concept-body-length">length</a> to <var title="">HTTPRequest</var>'s
   <a title="concept-request-body" href="#concept-request-body">body</a>'s payload body length.
   <!-- XXX xref payload body -->

   <li>
    <p>Whenever <var title="">HTTPRequest</var>'s
    <a title="concept-request-body" href="#concept-request-body">body</a> is read from (i.e. is transmitted),
    increase <var title="">HTTPRequest</var>'s <a title="concept-request-body" href="#concept-request-body">body</a>'s
    <a title="concept-body-transmitted" href="#concept-body-transmitted">transmitted</a> with the amount of
    payload body bytes transmitted and then <a href="#queue-a-fetch-task">queue a fetch task</a> on
    <var title="">request</var> to <dfn id="process-request-body">process request body</dfn> for
    <var title="">HTTPRequest</var>.
    <!-- XXX xref "read", "payload body" -->

    <p>Use the <a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#networking-task-source">networking task source</a>.
  </ol>

  <p>Run these substeps <a class="external" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel">in parallel</a>, after the outer
  set of steps has returned:

  <ol>
   <li><p>If <var title="">response</var>'s <a title="concept-response-body" href="#concept-response-body">body</a> is
   non-null, set <var title="">response</var>'s
   <a title="concept-response-body" href="#concept-response-body">body</a>'s
   <a title="concept-body-length" href="#concept-body-length">length</a> to <var title="">response</var>'s
   <a title="concept-response-body" href="#concept-response-body">body</a>'s payload body length.
   <!-- XXX xref payload body -->

   <li>
    <p>Whenever one or more bytes are transmitted, let <var title="">bytes</var> be the
    transmitted bytes and run these subsubsteps:

    <ol>
     <li><p>Increase <var title="">response</var>'s
     <a title="concept-response-body" href="#concept-response-body">body</a>'s
     <a title="concept-body-transmitted" href="#concept-body-transmitted">transmitted</a> with <var title="">bytes</var>'
     length.

     <li><p>Let <var title="">codings</var> be the result of
     <a title="concept-header-parse" href="#concept-header-parse">parsing</a> `<code title="">Content-Encoding</code>`
     in <var title="">response</var>'s
     <a title="concept-response-header-list" href="#concept-response-header-list">header list</a>.

     <li><p>Set <var title="">bytes</var> to the result of
     <a title="handle content codings" href="#handle-content-codings">handling content codings</a> given
     <var title="">codings</var> and <var title="">bytes</var>.

     <li><p>Push <var title="">bytes</var> to <var title="">response</var>'s
     <a title="concept-response-body" href="#concept-response-body">body</a>.
     <!-- XXX xref payload body / streams -->
    </ol>

   <li>If at any point <a title="concept-fetch" href="#concept-fetch">fetch</a> is
   <a title="concept-fetch-terminate" href="#concept-fetch-terminate">terminated</a> with reason
   <var title="">reason</var>, set <var title="">response</var>'s
   <a title="concept-response-termination-reason" href="#concept-response-termination-reason">termination reason</a> to
   <var title="">reason</var>.
  </ol>

  <p class="note no-backref">These are run <a class="external" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel">in parallel</a>
  as at this point it is unclear whether <var title="">response</var>'s
  <a title="concept-response-body" href="#concept-response-body">body</a> is relevant (<var title="">response</var>
  might be a redirect).

 <li>
  <p><a title="concept-header-list-delete" href="#concept-header-list-delete">Delete</a>
  `<code title="">Content-Encoding</code>` from <var title="">response</var>'s
  <a title="concept-response-header-list" href="#concept-response-header-list">header list</a> if one of the following
  conditions is true:

  <ul class="brief">
   <li><a title="concept-header-parse" href="#concept-header-parse">Parsing</a>
   `<code title="">Content-Encoding</code>` in <var title="">response</var>'s
   <a title="concept-response-header-list" href="#concept-response-header-list">header list</a> returns
   `<code title="">gzip</code>` and <a title="concept-header-parse" href="#concept-header-parse">parsing</a>
   `<code title="">Content-Type</code> in <var title="">response</var>'s
   <a title="concept-response-header-list" href="#concept-response-header-list">header list</a> returns
   `<code title="">application/gzip</code>`, `<code title="">application/x-gunzip</code>`, or
   `<code title="">application/x-gzip</code>`.
   <li><a title="concept-header-parse" href="#concept-header-parse">Parsing</a>
   `<code title="">Content-Encoding</code>` in <var title="">response</var>'s
   <a title="concept-response-header-list" href="#concept-response-header-list">header list</a> returns
   `<code title="">compress</code>` and <a title="concept-header-parse" href="#concept-header-parse">parsing</a>
   `<code title="">Content-Type</code> in <var title="">response</var>'s
   <a title="concept-response-header-list" href="#concept-response-header-list">header list</a> returns
   `<code title="">application/compress</code>` or
   `<code title="">application/x-compress</code>.
  </ul>

  <p class="note">This deals with broken Apache configurations. Ideally HTTP would define
  this.
  <!-- https://wiki.whatwg.org/wiki/HTTP -->

  <p class="XXX">Gecko
  <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1030660">bug 1030660</a> looks
  into whether this quirk can be removed.

 <li><p>If <var title="">response</var> is not a
 <a title="concept-network-error" href="#concept-network-error">network error</a> and <var title="">request</var>'s
 <a title="concept-request-cache-mode" href="#concept-request-cache-mode">cache mode</a> is not "<code title="">no-store</code>",
 update <var title="">response</var> in the HTTP cache for <var title="">request</var>.
 <!-- XXX xref HTTP cache -->
 <!-- Note: at this point cache mode cannot be /only-if-cached/ -->

 <li>
  <p>If <var title="">credentials flag</var> is set and <var title="">response</var>'s
  <a title="concept-response-header-list" href="#concept-response-header-list">header list</a> contains one or more
  <a title="concept-header" href="#concept-header">headers</a> <a title="concept-header-name" href="#concept-header-name">named</a>
  `<code title="">Set-Cookie</code>`, run these substeps:

  <ol>
   <li><p>Wait until ownership of the <a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#storage-mutex">storage mutex</a> can
   be taken by this instance of the <a title="concept-fetch" href="#concept-fetch">fetch</a> algorithm.

   <li><p>Take ownership of the <a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#storage-mutex">storage mutex</a>.

   <li>
    <p>Update the cookies. <a href="#refsCOOKIES">[COOKIES]</a>
    <!-- XXX proper hook? -->

    <p class="note">This is a fingerprinting vector.

   <li><p>Release the <a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#storage-mutex">storage mutex</a> so that it is once
   again free.
  </ol>

 <li><p>Return <var title="">response</var>. <span class="note no-backref">Typically
 <var title="">response</var>'s <a title="concept-response-body" href="#concept-response-body">body</a> is still being
 pushed to after returning.</span>
</ol>


<h3 id="cors-preflight-fetch"><span class="secno">4.5 </span>CORS preflight fetch</h3>

<p>To perform a <dfn id="cors-preflight-fetch-0">CORS preflight fetch</dfn> using <var title="">request</var>, run these
steps:

<ol>
 <li><p>Let <var title="">preflight</var> be a new <a title="concept-request" href="#concept-request">request</a>
 whose <a title="concept-request-method" href="#concept-request-method">method</a> is `<code title="">OPTIONS</code>`,
 <a title="concept-request-url" href="#concept-request-url">url</a> is <var title="">request</var>'s
 <a title="concept-request-url" href="#concept-request-url">url</a>,
 <a title="concept-request-context" href="#concept-request-context">context</a> is <var title="">request</var>'s
 <a title="concept-request-context" href="#concept-request-context">context</a>,
 <a title="concept-request-context-frame-type" href="#concept-request-context-frame-type">context frame type</a> is
 <var title="">request</var>'s
 <a title="concept-request-context-frame-type" href="#concept-request-context-frame-type">context frame type</a>,
 <a title="concept-request-origin" href="#concept-request-origin">origin</a> is <var title="">request</var>'s
 <a title="concept-request-origin" href="#concept-request-origin">origin</a>,
 <a href="#force-origin-header-flag">force <code>Origin</code> header flag</a> is set, and
 <a title="concept-request-referrer" href="#concept-request-referrer">referrer</a> is <var title="">request</var>'s
 <a title="concept-request-referrer" href="#concept-request-referrer">referrer</a>.

 <li><p><a title="concept-header-list-set" href="#concept-header-list-set">Set</a>
 `<code title="http-access-control-request-method"><a href="#http-access-control-request-method">Access-Control-Request-Method</a></code>` to
 <var title="">request</var>'s <a title="concept-request-method" href="#concept-request-method">method</a> in
 <var title="">preflight</var>'s <a title="concept-request-header-list" href="#concept-request-header-list">header list</a>.

 <li><p>Let <var title="">headers</var> be the <a title="concept-header-name" href="#concept-header-name">names</a>
 of <var title="">request</var>'s
 <a title="concept-request-header-list" href="#concept-request-header-list">header list</a>'s
 <a title="concept-header" href="#concept-header">headers</a>, excluding duplicates,
 sorted lexicographically, and <a title="byte lowercase" href="#byte-lowercase">byte lowercased</a>.

 <li><p>Let <var title="">value</var> be the items in <var title="">headers</var> separated from
 each other by 0x2C 0x20.

 <li><p><a title="concept-header-list-set" href="#concept-header-list-set">Set</a>
 `<code title="http-access-control-request-headers"><a href="#http-access-control-request-headers">Access-Control-Request-Headers</a></code>`
 to <var title="">value</var> in
 <var title="">preflight</var>'s <a title="concept-request-header-list" href="#concept-request-header-list">header list</a>.

 <li><p>Let <var title="">response</var> be the result of performing an
 <a title="concept-http-network-or-cache-fetch" href="#concept-http-network-or-cache-fetch">HTTP network or cache fetch</a> using
 <var title="">preflight</var>.

 <li>
  <p>If a <a title="concept-cors-check" href="#concept-cors-check">CORS check</a> for <var title="">request</var>
  and <var title="">response</var> returns success and <var title="">response</var>'s
  <a title="concept-response-status" href="#concept-response-status">status</a> is in the range 200 to 299, run these
  substeps:
  <!-- CORS said 200 here but nobody implemented that:
       http://lists.w3.org/Archives/Public/public-webappsec/2013Feb/0078.html -->

  <p class="note no-backref">The <a title="concept-cors-check" href="#concept-cors-check">CORS check</a> is done
  on <var title="">request</var> rather than <var title="">preflight</var> to ensure the correct
  <a title="concept-request-credentials-mode" href="#concept-request-credentials-mode">credentials mode</a> is used.

  <ol>
   <li><p>Let <var title="">methods</var> be the result of
   <a title="concept-header-parse" href="#concept-header-parse">parsing</a>
   `<code title="http-access-control-allow-methods"><a href="#http-access-control-allow-methods">Access-Control-Allow-Methods</a></code>` in
   <var title="">response</var>'s
   <a title="concept-response-header-list" href="#concept-response-header-list">header list</a>.

   <li><p>Let <var title="">headerNames</var> be the result of
   <a title="concept-header-parse" href="#concept-header-parse">parsing</a>
   `<code title="http-access-control-allow-headers"><a href="#http-access-control-allow-headers">Access-Control-Allow-Headers</a></code>` in
   <var title="">response</var>'s
   <a title="concept-response-header-list" href="#concept-response-header-list">header list</a>.

   <li><p>If either <var title="">methods</var> or <var title="">headerNames</var> is failure,
   return a <a title="concept-network-error" href="#concept-network-error">network error</a>.

   <li>
    <p>If <var title="">methods</var> is null and <var title="">request</var>'s
    <a title="concept-request-mode" href="#concept-request-mode">mode</a> is
    "<code title="">cors-with-forced-preflight</code>", set <var title="">methods</var> to
    <var title="">request</var>'s <a title="concept-request-method" href="#concept-request-method">method</a>.

    <p class="note no-backref">This ensures that a <a href="#cors-preflight-fetch-0">CORS preflight fetch</a> that
    happened due to <var title="">request</var>'s
    <a title="concept-request-mode" href="#concept-request-mode">mode</a> being
    "<code title="">cors-with-forced-preflight</code>" is <a title="concept-cache" href="#concept-cache">cached</a>.

   <li><p>If <var title="">request</var>'s <a title="concept-request-method" href="#concept-request-method">method</a>
   is not in <var title="">methods</var> and is not a <a href="#simple-method">simple method</a>, return a
   <a title="concept-network-error" href="#concept-network-error">network error</a>.

   <li><p>If one of <var title="">request</var>'s
   <a title="concept-request-header-list" href="#concept-request-header-list">header list</a>'
   <a title="concept-header-name" href="#concept-header-name">names</a> is not in <var title="">headerNames</var> and
   its corresponding <a title="concept-header" href="#concept-header">header</a> is not a
   <a href="#simple-header">simple header</a>, return a <a title="concept-network-error" href="#concept-network-error">network error</a>.

   <li><p>Let <var title="">max-age</var> be the result of
   <a title="concept-header-parse" href="#concept-header-parse">parsing</a>
   `<code title="http-access-control-max-age"><a href="#http-access-control-max-age">Access-Control-Max-Age</a></code>` in
   <var title="">response</var>'s
   <a title="concept-response-header-list" href="#concept-response-header-list">header list</a>.

   <li><p>If <var title="">max-age</var> is failure or null, set <var title="">max-age</var> to
   zero.

   <li><p>If <var title="">max-age</var> is greater than an imposed limit on
   <a title="concept-cache-max-age" href="#concept-cache-max-age">max-age</a>, set <var title="">max-age</var> to the imposed
   limit.

   <li><p>If the user agent does not provide for a <a title="concept-cache" href="#concept-cache">cache</a>,
   return <var title="">response</var>.

   <li><p>For each <var title="">method</var> in <var title="">methods</var> for which there is
   a <a title="concept-cache-match-method" href="#concept-cache-match-method">method cache match</a> using
   <var title="">request</var>, set matching entry's
   <a title="concept-cache-max-age" href="#concept-cache-max-age">max-age</a> to <var title="">max-age</var>.

   <li>
    <p>For each <var title="">method</var> in <var title="">methods</var> for which there is
    <em>no</em>  <a title="concept-cache-match-method" href="#concept-cache-match-method">method cache match</a> using
    <var title="">request</var>, create a new entry in
    <a title="concept-cache" href="#concept-cache">CORS preflight cache</a> as follows:

    <dl>
     <dt><a title="concept-cache-origin" href="#concept-cache-origin">origin</a>
     <dd><var title="">request</var>'s <a title="concept-request-origin" href="#concept-request-origin">origin</a>

     <dt><a title="concept-cache-url" href="#concept-cache-url">url</a>
     <dd><var title="">request</var>'s <a title="concept-request-url" href="#concept-request-url">url</a>

     <dt><a title="concept-cache-max-age" href="#concept-cache-max-age">max-age</a>
     <dd><var title="">max-age</var>

     <dt><a title="concept-cache-credentials" href="#concept-cache-credentials">credentials</a>
     <dd>False if <var title="">request</var>'s
     <a title="concept-request-credentials-mode" href="#concept-request-credentials-mode">credentials mode</a> is not
     "<code title="">include</code>", and true otherwise

     <dt><a title="concept-cache-method" href="#concept-cache-method">method</a></dt>
     <dd><var title="">method</var>
    </dl>

   <li><p>For each <var title="">headerName</var> in <var title="">headerNames</var> for which
   there is a <a title="concept-cache-match-header" href="#concept-cache-match-header">header name cache match</a> using
   <var title="">request</var>, set matching entry's
   <a title="concept-cache-max-age" href="#concept-cache-max-age">max-age</a> to <var title="">max-age</var>.

   <li>
    <p>For each <var title="">headerName</var> in <var title="">headerNames</var> for which
    there is <em>no</em>
    <a title="concept-cache-match-header" href="#concept-cache-match-header">header name cache match</a> using
    <var title="">request</var>, create a new entry in
    <a title="concept-cache" href="#concept-cache">CORS preflight cache</a> as follows:

    <dl>
     <dt><a title="concept-cache-origin" href="#concept-cache-origin">origin</a>
     <dd><var title="">request</var>'s <a title="concept-request-origin" href="#concept-request-origin">origin</a>

     <dt><a title="concept-cache-url" href="#concept-cache-url">url</a>
     <dd><var title="">request</var>'s <a title="concept-request-url" href="#concept-request-url">url</a>

     <dt><a title="concept-cache-max-age" href="#concept-cache-max-age">max-age</a>
     <dd><var title="">max-age</var>

     <dt><a title="concept-cache-credentials" href="#concept-cache-credentials">credentials</a>
     <dd>False if <var title="">request</var>'s
     <a title="concept-request-credentials-mode" href="#concept-request-credentials-mode">credentials mode</a> is not
     "<code title="">include</code>", and true otherwise

     <dt><a title="concept-cache-header-name" href="#concept-cache-header-name">header name</a></dt>
     <dd><var title="">headerName</var>
    </dl>

   <li><p>Return <var title="">response</var>.
  </ol>

 <li><p>Otherwise, return a <a title="concept-network-error" href="#concept-network-error">network error</a>.
</ol>


<h3 id="cors-preflight-cache"><span class="secno">4.6 </span>CORS preflight cache</h3>

<p>A <dfn title="concept-cache" id="concept-cache">CORS preflight cache</dfn> consists of a collection of
entries where each entry has these fields:
<dfn title="concept-cache-origin" id="concept-cache-origin">origin</dfn>,
<dfn title="concept-cache-url" id="concept-cache-url">url</dfn>,
<dfn title="concept-cache-max-age" id="concept-cache-max-age">max-age</dfn>,
<dfn title="concept-cache-credentials" id="concept-cache-credentials">credentials</dfn>,
<dfn title="concept-cache-method" id="concept-cache-method">method</dfn>, and
<dfn title="concept-cache-header-name" id="concept-cache-header-name">header name</dfn>.

<p>Entries must be removed after the seconds specified in the
<a title="concept-cache-max-age" href="#concept-cache-max-age">max-age</a> field have passed since storing the entry.
Entries may be removed before that moment arrives.

<p>To <dfn title="concept-cache-clear" id="concept-cache-clear">clear cache entries</dfn> given a
<var title="">request</var>, remove any entries in the
<a title="concept-cache" href="#concept-cache">CORS preflight cache</a> whose
<a title="concept-cache-origin" href="#concept-cache-origin">origin</a> is <var title="">request</var>'s
<a title="concept-request-origin" href="#concept-request-origin">origin</a> and whose
<a title="concept-cache-url" href="#concept-cache-url">url</a> is <var title="">request</var>'s
<a title="concept-request-url" href="#concept-request-url">url</a>.

<p>There is a <dfn title="concept-cache-match" id="concept-cache-match">cache match</dfn> for
<var title="">request</var> if <a title="concept-cache-origin" href="#concept-cache-origin">origin</a> is
<var title="">request</var>'s <a title="concept-request-origin" href="#concept-request-origin">origin</a>,
<a title="concept-cache-url" href="#concept-cache-url">url</a> is <var title="">request</var>'s
<a title="concept-request-url" href="#concept-request-url">url</a>, and either
<a title="concept-cache-credentials" href="#concept-cache-credentials">credentials</a> is false and
<var title="">request</var>'s
<a title="concept-request-credentials-mode" href="#concept-request-credentials-mode">credentials mode</a> is not
"<code title="">include</code>" or <a title="concept-cache-credentials" href="#concept-cache-credentials">credentials</a> is true.

<p>There is a <dfn title="concept-cache-match-method" id="concept-cache-match-method">method cache match</dfn> for
<var title="">method</var> using <var title="">request</var> when there is an entry in
<a title="concept-cache" href="#concept-cache">CORS preflight cache</a> for which there is a
<a title="concept-cache-match" href="#concept-cache-match">cache match</a> for <var title="">request</var> and its
<a title="concept-cache-method" href="#concept-cache-method">method</a> is <var title="">method</var>.

<p>There is a <dfn title="concept-cache-match-header" id="concept-cache-match-header">header name cache match</dfn> for
<var title="">headerName</var> using <var title="">request</var> when there is an entry in
<a title="concept-cache" href="#concept-cache">CORS preflight cache</a> for which there is a
<a title="concept-cache-match" href="#concept-cache-match">cache match</a> for <var title="">request</var> and its
<a title="concept-cache-header-name" href="#concept-cache-header-name">header name</a> is <var title="">headerName</var>.


<h3 id="cors-check"><span class="secno">4.7 </span>CORS check</h3>

<p>To perform a <dfn title="concept-cors-check" id="concept-cors-check">CORS check</dfn> for a
<var title="">request</var> and <var title="">response</var>, run these steps:

<ol>
 <li><p>Let <var title="">origin</var> be the result of
 <a title="concept-header-parse" href="#concept-header-parse">parsing</a>
 `<code title="http-access-control-allow-origin"><a href="#http-access-control-allow-origin">Access-Control-Allow-Origin</a></code>` in
 <var title="">response</var>'s <a title="concept-response-header-list" href="#concept-response-header-list">header list</a>.

 <li>
  <p>If <var title="">origin</var> is null or failure, return failure.

  <p class="note">Null is not `<code title="">null</code>`.

 <li><p>If <var title="">request</var>'s
 <a title="concept-request-credentials-mode" href="#concept-request-credentials-mode">credentials mode</a> is not
 "<code title="">include</code>" and <var title="">origin</var> is `<code title="">*</code>`, return success.

 <li><p>If <var title="">request</var>'s <a title="concept-request-origin" href="#concept-request-origin">origin</a>,
 <a title="ASCII serialization of an origin" class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#ascii-serialisation-of-an-origin">serialized</a>
 and <a title="utf-8 encode" class="external" href="https://encoding.spec.whatwg.org/#utf-8-encode">utf-8 encoded</a>, is not
 <var title="">origin</var>, return failure.
 <!-- XXX concept-as-bytes -->

 <li><p>If <var title="">request</var>'s
 <a title="concept-request-credentials-mode" href="#concept-request-credentials-mode">credentials mode</a> is not
 "<code title="">include</code>", return success.

 <li><p>Let <var title="">credentials</var> be the result of
 <a title="concept-header-parse" href="#concept-header-parse">parsing</a>
 `<code title="http-access-control-allow-credentials"><a href="#http-access-control-allow-credentials">Access-Control-Allow-Credentials</a></code>`
 in <var title="">response</var>'s
 <a title="concept-response-header-list" href="#concept-response-header-list">header list</a>.

 <li>
  <p>If <var title="">credentials</var> is `<code title="">true</code>`, return success.

  <p class="XXX">It has been suggested to check for <var title="">origin</var> not being
  `<code title="">null</code>` here as that would be equal to allowing credentials and
  `<code title="">*</code>` which is also forbidden.

 <li><p>Return failure.
</ol>



<h2 id="fetch-api"><span class="secno">5 </span>Fetch API</h2>

<p class="no-backref">The <code title="dom-global-fetch"><a href="#dom-global-fetch">fetch()</a></code> method is relatively
low-level API for <a title="concept-fetch" href="#concept-fetch">fetching</a> resources. It covers slightly
more ground than <code class="external"><a href="https://xhr.spec.whatwg.org/#xmlhttprequest">XMLHttpRequest</a></code>, although it is
currently lacking when it comes to reporting progression.

<div class="example no-backref">
 <p>The <code title="dom-global-fetch"><a href="#dom-global-fetch">fetch()</a></code> method makes it quite straightforward
 to <a title="concept-fetch" href="#concept-fetch">fetch</a> a resource and extract its contents as a
 <code class="external"><a href="http://dev.w3.org/2006/webapi/FileAPI/#blob">Blob</a></code>:

 <pre>fetch("/music/pk/altes-kamuffel.flac")
  .then(res =&gt; res.blob()).then(playBlob)</pre>

 <p>If you just care to log a particular response header:

 <pre>fetch("/", {method:"HEAD"})
  .then(res =&gt; log(res.headers.get("strict-transport-security")))</pre>

 <p>If you want to check a particular response header and then process the response of a
 cross-origin resources:

 <pre>fetch("https://pk.example/berlin-calling.json", {mode:"cors"})
  .then(res =&gt; {
    if(res.headers.get("content-type") == "application/json") {
      return res.json()
    } else {
      throw new TypeError()
    }
  }).then(processJSON)</pre>
</div>


<h3 id="headers-class"><span class="secno">5.1 </span>Headers class</h3>

<pre class="idl">typedef (<a href="#headers">Headers</a> or sequence&lt;sequence&lt;ByteString&gt;&gt; or OpenEndedDictionary&lt;ByteString&gt;) <dfn id="headersinit">HeadersInit</dfn>;</pre>

<div class="XXX">
 <p>OpenEndedDictionary&lt;T&gt; is a future IDL construct. Expect it to be used as such:

 <pre>var meta = { "Content-Type": "text/xml", "Breaking-Bad": "&lt;3" }
new Headers(meta)</pre>
</div>

<pre class="idl">[<a title="dom-Headers" href="#dom-headers">Constructor</a>(optional <a href="#headersinit">HeadersInit</a> <var title="">init</var>),
 Exposed=(Window,Worker)]
interface <dfn id="headers">Headers</dfn> {
  void <a title="dom-Headers-append" href="#dom-headers-append">append</a>(ByteString <var title="">name</var>, ByteString <var title="">value</var>);
  void <a title="dom-Headers-delete" href="#dom-headers-delete">delete</a>(ByteString <var title="">name</var>);
  ByteString? <a title="dom-Headers-get" href="#dom-headers-get">get</a>(ByteString <var title="">name</var>);
  sequence&lt;ByteString&gt; <a title="dom-Headers-getAll" href="#dom-headers-getall">getAll</a>(ByteString <var title="">name</var>);
  boolean <a title="dom-Headers-has" href="#dom-headers-has">has</a>(ByteString <var title="">name</var>);
  void <a title="dom-Headers-set" href="#dom-headers-set">set</a>(ByteString <var title="">name</var>, ByteString <var title="">value</var>);
  iterable&lt;ByteString, ByteString&gt;;
};</pre>

<p>A <code><a href="#headers">Headers</a></code> object has an associated
<dfn title="concept-Headers-header-list" id="concept-headers-header-list">header list</dfn> (a
<a title="concept-header-list" href="#concept-header-list">header list</a>), which is initially empty.

<p>A <code><a href="#headers">Headers</a></code> object also has an associated
<dfn title="concept-Headers-guard" id="concept-headers-guard">guard</dfn>, which is one of <i title="">immutable</i>,
<i title="">request</i>, <i title="">request-no-CORS</i>, <i title="">response</i> and
"<code title="">none</code>" (initially "<code title="">none</code>").

<p class="note no-backref"><i title="">immutable</i> exists for service workers.
<a href="#refsSW">[SW]</a>

<p>To <dfn title="concept-Headers-fill" id="concept-headers-fill">fill</dfn> a <code><a href="#headers">Headers</a></code> object
(<var title="">headers</var>) with a given object (<var title="">object</var>), run these steps:

<ol>
 <li>
  <p>If <var title="">object</var> is a <code><a href="#headers">Headers</a></code> object, copy its
  <a title="concept-Headers-header-list" href="#concept-headers-header-list">header list</a> as
  <var title="">headerListCopy</var> and then for each <var title="">header</var> in
  <var title="">headerListCopy</var>, retaining order,
  <a title="concept-Headers-append" href="#concept-headers-append">append</a>
  <var title="">header</var>'s <a title="concept-header-name" href="#concept-header-name">name</a>/<var title="">header</var>'s <a title="concept-header-value" href="#concept-header-value">value</a>
  to <var title="">headers</var>. Rethrow any exception.

  <p class="note">Once <code title="">Headers.prototype[Symbol.iterator]</code> is defined this
  special casing will no longer be needed.

 <li>
  <p>Otherwise, if <var title="">object</var> is a sequence, then for each
  <var title="">header</var> in <var title="">object</var>, run these substeps:

  <ol>
   <li><p>If <var title="">header</var> does not contain exactly two items,
   <a class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">TypeError</code>.

   <li><p><a title="concept-Headers-append" href="#concept-headers-append">Append</a>
   <var title="">header</var>'s first item/<var title="">header</var>'s second item to
   <var title="">headers</var>. Rethrow any exception.
  </ol>

 <li>
  <p>Otherwise, if <var title="">object</var> is an open-ended dictionary, then for each
  <var title="">header</var> in <var title="">object</var>, run these substeps:

  <ol>
   <li><p>Set <var title="">header</var>'s key to <var title="">header</var>'s key,
   <a title="es-ByteString" class="external" href="http://heycam.github.io/webidl/#es-ByteString">converted to ByteString</a>.
   Rethrow any exception.

   <li><p><a title="concept-Headers-append" href="#concept-headers-append">Append</a>
   <var title="">header</var>'s key/<var title="">header</var>'s value to
   <var title="">headers</var>. Rethrow any exception.
  </ol>
</ol>

<p>The <dfn title="dom-Headers" id="dom-headers"><code>Headers(<var>init</var>)</code></dfn> constructor,
when invoked, must run these steps:

<ol>
 <li><p>Let <var title="">headers</var> be a new <code><a href="#headers">Headers</a></code> object.

 <li><p>If <var title="">init</var> is given, <a title="concept-Headers-fill" href="#concept-headers-fill">fill</a>
 <var title="">headers</var> with <var title="">init</var>. Rethrow any exception.

 <li><p>Return <var title="">headers</var>.
</ol>

<p>To <dfn title="concept-Headers-append" id="concept-headers-append">append</dfn> a
<a title="concept-header-name" href="#concept-header-name">name</a>/<a title="concept-header-value" href="#concept-header-value">value</a>
(<var title="">name</var>/<var title="">value</var>) pair to a
<code><a href="#headers">Headers</a></code> object (<var title="">headers</var>), run these steps:

<ol>
 <li><p>If <var title="">name</var> is not a <a title="concept-header-name" href="#concept-header-name">name</a> or
 <var title="">value</var> is not a <a title="concept-header-value" href="#concept-header-value">value</a>,
 <a class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">TypeError</code>.

 <li><p>If <a title="concept-Headers-guard" href="#concept-headers-guard">guard</a> is <i title="">immutable</i>,
 <a class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">TypeError</code>.

 <li><p>Otherwise, if <a title="concept-Headers-guard" href="#concept-headers-guard">guard</a> is
 <i title="">request</i> and <var title="">name</var> is a <a href="#forbidden-header-name">forbidden header name</a>,
 return.

 <li><p>Otherwise, if <a title="concept-Headers-guard" href="#concept-headers-guard">guard</a> is
 <i title="">request-no-CORS</i> and <var title="">name</var>/<var title="">value</var> is not a
 <a href="#simple-header">simple header</a>, return.

 <li><p>Otherwise, if <a title="concept-Headers-guard" href="#concept-headers-guard">guard</a> is
 <i title="">response</i> and <var title="">name</var> is a
 <a href="#forbidden-response-header-name">forbidden response header name</a>, return.

 <li><p><a title="concept-header-list-append" href="#concept-header-list-append">Append</a>
 <var title="">name</var>/<var title="">value</var> to
 <a title="concept-Headers-header-list" href="#concept-headers-header-list">header list</a>.
</ol>

<p>The
<dfn title="dom-Headers-append" id="dom-headers-append"><code>append(<var>name</var>, <var>value</var>)</code></dfn>
method, when invoked, must <a title="concept-Headers-append" href="#concept-headers-append">append</a>
<var title="">name</var>/<var title="">value</var> to the
<a class="external" href="https://dom.spec.whatwg.org/#context-object">context object</a> and rethrow any exception.

<p>The <dfn title="dom-Headers-delete" id="dom-headers-delete"><code>delete(<var>name</var>)</code></dfn>
method, when invoked, must run these steps:

<ol>
 <li><p>If <var title="">name</var> is not a <a title="concept-header-name" href="#concept-header-name">name</a>,
 <a class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">TypeError</code>.

 <li><p>If <a title="concept-Headers-guard" href="#concept-headers-guard">guard</a> is <i title="">immutable</i>,
 <a class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">TypeError</code>.

 <li><p>Otherwise, if <a title="concept-Headers-guard" href="#concept-headers-guard">guard</a> is
 <i title="">request</i> and <var title="">name</var> is a <a href="#forbidden-header-name">forbidden header name</a>,
 return.

 <li><p>Otherwise, if <a title="concept-Headers-guard" href="#concept-headers-guard">guard</a> is
 <i title="">request-no-CORS</i> and <var title="">name</var>/`<code title="">invalid</code>` is
 not a <a href="#simple-header">simple header</a>, return.

 <li><p>Otherwise, if <a title="concept-Headers-guard" href="#concept-headers-guard">guard</a> is
 <i title="">response</i> and <var title="">name</var> is a
 <a href="#forbidden-response-header-name">forbidden response header name</a>, return.

 <li><p><a title="concept-header-list-delete" href="#concept-header-list-delete">Delete</a> <var title="">name</var> from
 <a title="concept-Headers-header-list" href="#concept-headers-header-list">header list</a>.
</ol>

<p>The <dfn title="dom-Headers-get" id="dom-headers-get"><code>get(<var>name</var>)</code></dfn> method, when
invoked, must run these steps:

<ol>
 <li><p>If <var title="">name</var> is not a <a title="concept-header-name" href="#concept-header-name">name</a>,
 <a class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">TypeError</code>.

 <li><p>Return the <a title="concept-header-value" href="#concept-header-value">value</a> of the first
 <a title="concept-header" href="#concept-header">header</a> in
 <a title="concept-Headers-header-list" href="#concept-headers-header-list">header list</a> whose
 <a title="concept-header-name" href="#concept-header-name">name</a> is <var title="">name</var>, and null otherwise.
</ol>

<p>The <dfn title="dom-Headers-getAll" id="dom-headers-getall"><code>getAll(<var>name</var>)</code></dfn> method,
when invoked, must run these steps:

<ol>
 <li><p>If <var title="">name</var> is not a <a title="concept-header-name" href="#concept-header-name">name</a>,
 <a class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">TypeError</code>.

 <li><p>Return the <a title="concept-header-value" href="#concept-header-value">values</a> of all
 <a title="concept-header" href="#concept-header">headers</a> in
 <a title="concept-Headers-header-list" href="#concept-headers-header-list">header list</a> whose
 <a title="concept-header-name" href="#concept-header-name">name</a> is <var title="">name</var>, in list order, and
 the empty sequence otherwise.
</ol>

<p>The <dfn title="dom-Headers-has" id="dom-headers-has"><code>has(<var title="">name</var>)</code></dfn> method,
when invoked, must run these steps:

<ol>
 <li><p>If <var title="">name</var> is not a <a title="concept-header-name" href="#concept-header-name">name</a>,
 <a class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">TypeError</code>.

 <li><p>Return true if there is a <a title="concept-header" href="#concept-header">header</a> in
 <a title="concept-Headers-header-list" href="#concept-headers-header-list">header list</a> whose
 <a title="concept-header-name" href="#concept-header-name">name</a> is <var title="">name</var>, and false
 otherwise.
</ol>

<p>The
<dfn title="dom-Headers-set" id="dom-headers-set"><code>set(<var>name</var>, <var>value</var>)</code></dfn>
method, when invoked, must run these steps:

<ol>
 <li><p>If <var title="">name</var> is not a <a title="concept-header-name" href="#concept-header-name">name</a> or
 <var title="">value</var> is not a <a title="concept-header-value" href="#concept-header-value">value</a>,
 <a class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">TypeError</code>.

 <li><p>If <a title="concept-Headers-guard" href="#concept-headers-guard">guard</a> is <i title="">immutable</i>,
 <a class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">TypeError</code>.

 <li><p>Otherwise, if <a title="concept-Headers-guard" href="#concept-headers-guard">guard</a> is
 <i title="">request</i> and <var title="">name</var> is a <a href="#forbidden-header-name">forbidden header name</a>,
 return.

 <li><p>Otherwise, if <a title="concept-Headers-guard" href="#concept-headers-guard">guard</a> is
 <i title="">request-no-CORS</i> and <var title="">name</var>/<var title="">value</var> is not a
 <a href="#simple-header">simple header</a>, return.

 <li><p>Otherwise, if <a title="concept-Headers-guard" href="#concept-headers-guard">guard</a> is
 <i title="">response</i> and <var title="">name</var> is a
 <a href="#forbidden-response-header-name">forbidden response header name</a>, return.

 <li><p><a title="concept-header-list-set" href="#concept-header-list-set">Set</a>
 <var title="">name</var>/<var title="">value</var> in
 <a title="concept-Headers-header-list" href="#concept-headers-header-list">header list</a>.
</ol>

<p>The <a class="external" href="http://heycam.github.io/webidl/#dfn-value-pairs-to-iterate-over">value pairs to iterate over</a> are the
<a title="concept-header" href="#concept-header">headers</a> in the
<a title="concept-Headers-header-list" href="#concept-headers-header-list">header list</a> with the key being the
<a title="concept-header-name" href="#concept-header-name">name</a> and value the
<a title="concept-header-value" href="#concept-header-value">value</a>.


<h3 id="body-mixin"><span class="secno">5.2 </span>Body mixin</h3>

<pre class="idl">typedef object <dfn id="json">JSON</dfn>;
typedef (<a class="external" href="http://dev.w3.org/2006/webapi/FileAPI/#blob">Blob</a> or BufferSource or <a class="external" href="https://xhr.spec.whatwg.org/#formdata">FormData</a> or <a class="external" href="https://url.spec.whatwg.org/#urlsearchparams">URLSearchParams</a> or USVString) <dfn id="bodyinit">BodyInit</dfn>;</pre>

<p>To <dfn title="concept-BodyInit-extract" id="concept-bodyinit-extract">extract</dfn> a byte stream and a
`<code title="">Content-Type</code>` <a title="concept-header-value" href="#concept-header-value">value</a> from
<var title="">object</var>, run these steps:

<ol>
 <li><p>Let <var title="">stream</var> be an empty byte stream.

 <li><p>Let <var title="">Content-Type</var> be null.

 <li>
  <p>Switch on <var title="">object</var>'s type:

  <dl class="switch">
   <dt><code class="external"><a href="http://dev.w3.org/2006/webapi/FileAPI/#blob">Blob</a></code>
   <dd>
    <p>Push a copy of <var title="">object</var>'s contents to <var title="">stream</var>.

    <p>If <var title="">object</var>'s
    <code title="dom-Blob-type" class="external"><a href="http://dev.w3.org/2006/webapi/FileAPI/#dfn-type">type</a></code> attribute is not the
    empty byte sequence, set <var title="">Content-Type</var> to its value.

   <dt><code title="">BufferSource</code>
   <dd>
    <p>Push a
    <a title="get a copy of the bytes held by the buffer source" class="external" href="http://heycam.github.io/webidl/#dfn-get-buffer-source-copy">copy of</a>
    <var title="">object</var> to <var title="">stream</var>.

   <dt><code class="external"><a href="https://xhr.spec.whatwg.org/#formdata">FormData</a></code>
   <dd>
    <p>Push the result of running the
    <a class="external" href="https://html.spec.whatwg.org/multipage/forms.html#multipart/form-data-encoding-algorithm"><code>multipart/form-data</code> encoding algorithm</a>,
    with <var>object</var> as <var>form data set</var> and with
    <a class="external" href="https://encoding.spec.whatwg.org/#utf-8">utf-8</a> as the explicit character encoding, to
    <var title="">stream</var>.
    <!-- need to provide explicit character encoding because otherwise the encoding of the
         document is used -->

    <p>Set <var>Content-Type</var> to `<code title="">multipart/form-data;boundary=</code>`,
    followed by the
    <a class="external" href="https://html.spec.whatwg.org/multipage/forms.html#multipart/form-data-boundary-string"><code>multipart/form-data</code> boundary string</a>
    generated by the
    <a class="external" href="https://html.spec.whatwg.org/multipage/forms.html#multipart/form-data-encoding-algorithm"><code>multipart/form-data</code> encoding algorithm</a>.

   <dt><code class="external"><a href="https://url.spec.whatwg.org/#urlsearchparams">URLSearchParams</a></code>
   <dd>
    <p>Push the result of running the
    <a title="concept-urlencoded-serializer" class="external" href="https://url.spec.whatwg.org/#concept-urlencoded-serializer"><code>application/x-www-form-urlencoded</code> serializer</a>,
    with <var>object</var>'s
    <a title="concept-URLSearchParams-list" class="external" href="https://url.spec.whatwg.org/#concept-urlsearchparams-list">list</a>, to
    <var title="">stream</var>.
    <!-- utf-8 implied -->

    <p>Set <var>Content-Type</var> to
    `<code title="">application/x-www-form-urlencoded;charset=UTF-8</code>`.

   <dt><code title="">USVString</code>
   <dd>
    <p>Push the result of running <a class="external" href="https://encoding.spec.whatwg.org/#utf-8-encode">utf-8 encode</a> on
    <var title="">object</var> to <var title="">stream</var>.
    <p>Set <var title="">Content-Type</var> to `<code title="">text/plain;charset=UTF-8</code>`.
  </dl>

 <li><p>Return <var title="">stream</var> and <var title="">Content-Type</var>.
</ol>


<pre class="idl">[NoInterfaceObject,
 Exposed=(Window,Worker)]
interface <dfn id="body">Body</dfn> {
  readonly attribute boolean <a title="dom-Body-bodyUsed" href="#dom-body-bodyused">bodyUsed</a>;
  [NewObject] Promise&lt;ArrayBuffer&gt; <a title="dom-Body-arrayBuffer" href="#dom-body-arraybuffer">arrayBuffer</a>();
  [NewObject] Promise&lt;<a class="external" href="http://dev.w3.org/2006/webapi/FileAPI/#blob">Blob</a>&gt; <a title="dom-Body-blob" href="#dom-body-blob">blob</a>();
  [NewObject] Promise&lt;<a class="external" href="https://xhr.spec.whatwg.org/#formdata">FormData</a>&gt; <a title="dom-Body-formData" href="#dom-body-formdata">formData</a>();
  [NewObject] Promise&lt;<a href="#json">JSON</a>&gt; <a title="dom-Body-json" href="#dom-body-json">json</a>();
  [NewObject] Promise&lt;USVString&gt; <a title="dom-Body-text" href="#dom-body-text">text</a>();
};</pre>

<p class="note">Formats you would not want a network layer to be dependent upon, such as
HTML, will likely not be exposed here. Rather, an HTML parser API might accept a stream in
due course.
<!-- http://lists.w3.org/Archives/Public/public-whatwg-archive/2014Jun/thread.html#msg72 -->

<p>Objects implementing the <code><a href="#body">Body</a></code> mixin gain an associated
<dfn title="concept-Body-body" id="concept-body-body">body</dfn> (a byte stream), a
<dfn title="concept-Body-used-flag" id="concept-body-used-flag">used flag</dfn> (initially unset), and a
<dfn title="concept-Body-MIME-type" id="concept-body-mime-type">MIME type</dfn> (initially the empty byte sequence).

<p>The <dfn title="dom-Body-bodyUsed" id="dom-body-bodyused"><code>bodyUsed</code></dfn> attribute's getter must
return true if the <a title="concept-Body-used-flag" href="#concept-body-used-flag">used flag</a> is set, and false
otherwise.

<p>Objects implementing the <code><a href="#body">Body</a></code> mixin also have an associated
<dfn title="concept-Body-consume-body" id="concept-body-consume-body">consume body</dfn> algorithm, which given a
<var title="">type</var>, runs these steps:

<ol>
 <li><p>Let <var title="">p</var> be a new promise.

 <li><p>If <a title="concept-Body-used-flag" href="#concept-body-used-flag">used flag</a> is set, reject
 <var title="">p</var> with a <code title="">TypeError</code>.

 <li>
  <p>Otherwise, set <a title="concept-Body-used-flag" href="#concept-body-used-flag">used flag</a> and then run these
  substeps <a class="external" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel">in parallel</a>:
  <!-- We do not check for body being null to make this API work consistently.
       Otherwise we'd need an additional flag. -->

  <ol>
   <li><p>Let <var title="">stream</var> be <a title="concept-Body-body" href="#concept-body-body">body</a>.

   <li><p>If <var title="">stream</var> is null, set <var title="">stream</var> to an empty byte
   sequence.

   <li><p>Let <var title="">bytes</var> be the result of reading from <var title="">stream</var>
   until it returns end-of-stream.
   <!-- XXX stream -->

   <li>
    <p>Switch on <var title="">type</var>:

    <dl class="switch">
     <dt><i title="">ArrayBuffer</i>
     <dd><p>Resolve <var title="">p</var> with an <code>ArrayBuffer</code> whose contents are
     <var title="">bytes</var>.

     <dt><i title="">Blob</i>
     <dd><p>Resolve <var title="">p</var> with a <code class="external"><a href="http://dev.w3.org/2006/webapi/FileAPI/#blob">Blob</a></code>
     whose contents are <var title="">bytes</var> and
     <code title="dom-Blob-type" class="external"><a href="http://dev.w3.org/2006/webapi/FileAPI/#dfn-type">type</a></code> is
     <a title="concept-Body-MIME-type" href="#concept-body-mime-type">MIME type</a>.

     <dt><i title="">FormData</i>
     <dd>
      <p>If <a title="concept-Body-MIME-type" href="#concept-body-mime-type">MIME type</a> (ignoring parameters)
      is `<code>multipart/form-data</code>`, run these subsubsteps:

      <ol>
       <li><p>Parse <var title="">bytes</var>, using the value of the
       `<code title="">boundary</code>` parameter from
       <a title="concept-Body-MIME-type" href="#concept-body-mime-type">MIME type</a> and
       <a class="external" href="https://encoding.spec.whatwg.org/#utf-8">utf-8</a> as encoding, per the rules set forth
       in <cite>Returning Values from Forms: multipart/form-data</cite>.
       <a href="#refsRFC2388">[RFC2388]</a>

       <li><p>If that fails for some reason, reject <var title="">p</var> with a
       <code title="">TypeError</code>.

       <li><p>Otherwise, resolve <var title="">p</var> with a new
       <code class="external"><a href="https://xhr.spec.whatwg.org/#formdata">FormData</a></code> object, running
       <a class="external" href="https://xhr.spec.whatwg.org/#create-an-entry">create an entry</a> for each entry as the result of
       the parsing operation and appending it to
       <a title="concept-FormData-entry" class="external" href="https://xhr.spec.whatwg.org/#concept-formdata-entry">entries</a>.
      </ol>

      <p class="XXX">The above is a rough approximation of what is required for
      `<code>multipart/form-data</code>`, a more detailed parsing specification is to be
      written. Volunteers welcome.

      <p>Otherwise, if <a title="concept-Body-MIME-type" href="#concept-body-mime-type">MIME type</a>
      (ignoring parameters) is `<code>application/x-www-form-urlencoded</code>`, run these
      subsubsteps:

      <ol>
       <li><p>Let <var title="">entries</var> be the result of
       <a title="concept-urlencoded-parser" class="external" href="https://url.spec.whatwg.org/#concept-urlencoded-parser">parsing</a>
       <var title="">bytes</var>.

       <li><p>If <var title="">entries</var> is failure, reject <var title="">p</var> with a
       <code title="">TypeError</code>.

       <li><p>Resolve <var title="">p</var> with a new
       <code class="external"><a href="https://xhr.spec.whatwg.org/#formdata">FormData</a></code> object whose
       <a title="concept-FormData-entry" class="external" href="https://xhr.spec.whatwg.org/#concept-formdata-entry">entries</a> are
       <var title="">entries</var>.
      </ol>

      <p>Otherwise, reject <var title="">p</var> with a <code title="">TypeError</code>.

     <dt><i title="">JSON</i>
     <dd>
      <p>Let <var title="">JSON</var> be the result of invoking the initial value of the
      <code title="">parse</code> property of the <code title="">JSON</code> object with the
      result of running <a class="external" href="https://encoding.spec.whatwg.org/#utf-8-decode">utf-8 decode</a> on
      <var title="">bytes</var> as argument.

      <p>If that threw an exception, reject <var title="">p</var> with that exception.

      <p>Otherwise, resolve <var title="">p</var> with <var title="">JSON</var>.

     <dt><i title="">text</i>
     <dd><p>Resolve <var title="">p</var> with the result of running
     <a class="external" href="https://encoding.spec.whatwg.org/#utf-8-decode">utf-8 decode</a> on <var title="">bytes</var>.
    </dl>
  </ol>

 <li><p>Return <var title="">p</var>.
</ol>

<p>The <dfn title="dom-Body-arrayBuffer" id="dom-body-arraybuffer"><code>arrayBuffer()</code></dfn>
method, when invoked, must return the result of running
<a title="concept-Body-consume-body" href="#concept-body-consume-body">consume body</a> with <i title="">ArrayBuffer</i>.

<p>The <dfn title="dom-Body-blob" id="dom-body-blob"><code>blob()</code></dfn> method, when
invoked, must return the result of running
<a title="concept-Body-consume-body" href="#concept-body-consume-body">consume body</a> with <i title="">Blob</i>.

<p>The <dfn title="dom-Body-formData" id="dom-body-formdata"><code>formData()</code></dfn> method,
when invoked, must return the result of running
<a title="concept-Body-consume-body" href="#concept-body-consume-body">consume body</a> with <i title="">FormData</i>.

<p>The <dfn title="dom-Body-json" id="dom-body-json"><code>json()</code></dfn> method, when
invoked, must return the result of running
<a title="concept-Body-consume-body" href="#concept-body-consume-body">consume body</a> with <i title="">JSON</i>.

<p>The <dfn title="dom-Body-text" id="dom-body-text"><code>text()</code></dfn> method, when
invoked, must return the result of running
<a title="concept-Body-consume-body" href="#concept-body-consume-body">consume body</a> with <i title="">text</i>.


<h3 id="request-class"><span class="secno">5.3 </span>Request class</h3>

<!-- No client member, see
  https://github.com/slightlyoff/ServiceWorker/issues/318
  https://github.com/slightlyoff/ServiceWorker/issues/575 -->

<pre class="idl">typedef (<a href="#request">Request</a> or USVString) <dfn id="requestinfo">RequestInfo</dfn>;

[<a title="dom-Request" href="#dom-request">Constructor</a>(<a href="#requestinfo">RequestInfo</a> <var title="">input</var>, optional <a href="#requestinit">RequestInit</a> <var title="">init</var>),
 Exposed=(Window,Worker)]
interface <dfn id="request">Request</dfn> {
  readonly attribute ByteString <a title="dom-Request-method" href="#dom-request-method">method</a>;
  readonly attribute USVString <a title="dom-Request-url" href="#dom-request-url">url</a>;
  [SameObject] readonly attribute <a href="#headers">Headers</a> <a title="dom-Request-headers" href="#dom-request-headers">headers</a>;

  readonly attribute <a href="#requestcontext">RequestContext</a> <a title="dom-Request-context" href="#dom-request-context">context</a>;<!--
  readonly attribute DOMString <span title=dom-Request-origin>origin</span>;-->
  readonly attribute DOMString <a title="dom-Request-referrer" href="#dom-request-referrer">referrer</a>;<!--
  readonly attribute boolean <span title=dom-Request-handles401>handles401</span>;
  readonly attribute boolean <span title=dom-Request-isSynchronous>isSynchronous</span>;-->
  readonly attribute <a href="#requestmode">RequestMode</a> <a title="dom-Request-mode" href="#dom-request-mode">mode</a>;
  readonly attribute <a href="#requestcredentials">RequestCredentials</a> <a title="dom-Request-credentials" href="#dom-request-credentials">credentials</a>;<!--
  readonly attribute boolean <span title=dom-Request-usingURLCredentials>usingURLCredentials</span>;-->
  readonly attribute <a href="#requestcache">RequestCache</a> <a title="dom-Request-cache" href="#dom-request-cache">cache</a>;<!--
  readonly attribute boolean <span title=dom-Request-handlesRedirects>handlesRedirects</span>;-->

  [NewObject] <a href="#request">Request</a> <a title="dom-Request-clone" href="#dom-request-clone">clone</a>();
};
<a href="#request">Request</a> implements <a href="#body">Body</a>;

dictionary <dfn id="requestinit">RequestInit</dfn> {
  ByteString method;
  <a href="#headersinit">HeadersInit</a> headers;
  <a href="#bodyinit">BodyInit</a> body;
  <a href="#requestmode">RequestMode</a> mode;
  <a href="#requestcredentials">RequestCredentials</a> credentials;
  <a href="#requestcache">RequestCache</a> cache;
};

enum <dfn id="requestcontext">RequestContext</dfn> {
  "audio", "beacon", "cspreport", "download", "embed", "eventsource", "favicon", "fetch",
  "font", "form", "frame", "hyperlink", "iframe", "image", "imageset", "import",
  "internal", "location", "manifest", "object", "ping", "plugin", "prefetch", "script",
  "serviceworker", "sharedworker", "subresource", "style", "track", "video", "worker",
  "xmlhttprequest", "xslt"
};
enum <dfn id="requestmode">RequestMode</dfn> { "same-origin", "no-cors", "cors" };
enum <dfn id="requestcredentials">RequestCredentials</dfn> { "omit", "same-origin", "include" };
enum <dfn id="requestcache">RequestCache</dfn> { "default", "no-store", "reload", "no-cache", "force-cache", "only-if-cached" };</pre>

<p>A <code><a href="#request">Request</a></code> object has an associated
<dfn title="concept-Request-request" id="concept-request-request">request</dfn> (a
<a title="concept-request" href="#concept-request">request</a>).

<p>A <code><a href="#request">Request</a></code> object also has an associated <code><a href="#headers">Headers</a></code> object which
is itself associated with <a title="concept-Request-request" href="#concept-request-request">request</a>'s
<a title="concept-request-header-list" href="#concept-request-header-list">header list</a> and whose
<a title="concept-Headers-guard" href="#concept-headers-guard">guard</a> is <i title="">request</i>.

<p>A <code><a href="#request">Request</a></code> object's <a title="concept-Body-body" href="#concept-body-body">body</a> is its
<a title="concept-Request-request" href="#concept-request-request">request</a>'s
<a title="concept-request-body" href="#concept-request-body">body</a>.

<hr>

<p>The
<dfn title="dom-Request" id="dom-request"><code>Request(<var>input</var>, <var>init</var>)</code></dfn>
constructor must run these steps:

<ol>
 <li>
  <p>If <var title="">input</var> is a <code><a href="#request">Request</a></code> object and
  <var title="">input</var>'s <a title="concept-Body-body" href="#concept-body-body">body</a> is non-null, run
  these substeps:

  <ol>
   <li><p>If <var title="">input</var>'s <a title="concept-Body-used-flag" href="#concept-body-used-flag">used flag</a>
   is set, <a class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">TypeError</code>.

   <li><p>Set <var title="">input</var>'s
   <a title="concept-Body-used-flag" href="#concept-body-used-flag">used flag</a>.
  </ol>

 <li><p>Let <var title="">request</var> be <var title="">input</var>'s
 <a title="concept-Request-request" href="#concept-request-request">request</a>, if <var title="">input</var> is a
 <code><a href="#request">Request</a></code> object, and a new <a title="concept-request" href="#concept-request">request</a>
 otherwise.

 <li><p>Set <var title="">request</var> to a new <a title="concept-request" href="#concept-request">request</a>
 whose <a title="concept-request-url" href="#concept-request-url">url</a> is <var title="">request</var>'s
 <a title="concept-request-url" href="#concept-request-url">url</a>,
 <a title="concept-request-method" href="#concept-request-method">method</a> is <var title="">request</var>'s
 <a title="concept-request-method" href="#concept-request-method">method</a>,
 <a title="concept-request-header-list" href="#concept-request-header-list">header list</a> is a copy of
 <var title="">request</var>'s <a title="concept-request-header-list" href="#concept-request-header-list">header list</a>,
 <span title="concept-unsafe-request-flag">unsafe request flag</span> is set,
 <a title="concept-request-body" href="#concept-request-body">body</a> is <var title="">request</var>'s
 <a title="concept-request-body" href="#concept-request-body">body</a>,
 <a title="concept-request-client" href="#concept-request-client">client</a> is
 <a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#entry-settings-object">entry settings object</a>,
 <a title="concept-request-origin" href="#concept-request-origin">origin</a> is
 <a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#entry-settings-object">entry settings object</a>'s
 <a class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#origin">origin</a>,
 <a href="#force-origin-header-flag">force <code>Origin</code> header flag</a> is set,
 <a href="#same-origin-data-url-flag">same-origin data URL flag</a> is set,
 <a title="concept-request-context" href="#concept-request-context">context</a> is "<code title="">fetch</code>",
 <a title="concept-request-mode" href="#concept-request-mode">mode</a> is <var title="">request</var>'s
 <a title="concept-request-mode" href="#concept-request-mode">mode</a>,
 <a title="concept-request-credentials-mode" href="#concept-request-credentials-mode">credentials mode</a> is
 <var title="">request</var>'s
 <a title="concept-request-credentials-mode" href="#concept-request-credentials-mode">credentials mode</a>,
 and
 <a title="concept-request-cache-mode" href="#concept-request-cache-mode">cache mode</a> is
 <var title="">request</var>'s
 <a title="concept-request-cache-mode" href="#concept-request-cache-mode">cache mode</a>.

 <li><p>Let <var title="">fallbackMode</var> be null.

 <li><p>Let <var title="">fallbackCredentials</var> be null.

 <li><p>Let <var title="">fallbackCache</var> be null.

 <li>
  <p>If <var title="">input</var> is a string, run these substeps:

  <ol>
   <li><p>Let <var title="">parsedURL</var> be the result of
   <a title="concept-url-parser" class="external" href="https://url.spec.whatwg.org/#concept-url-parser">parsing</a>
   <var title="">input</var> with <a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#entry-settings-object">entry settings object</a>'s
   <a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#api-base-url">API base URL</a>.

   <li><p>If <var title="">parsedURL</var> is failure,
   <a class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">TypeError</code>.

   <li><p>Set <var title="">request</var>'s <a title="concept-request-url" href="#concept-request-url">url</a> to
   <var title="">parsedURL</var>.

   <li><p>Set <var title="">fallbackMode</var> to "<code title="">cors</code>".

   <li><p>Set <var title="">fallbackCredentials</var> to "<code title="">omit</code>".

   <li><p>Set <var title="">fallbackCache</var> to "<code title="">default</code>".
  </ol>

 <li><p>Let <var title="">mode</var> be <var title="">init</var>'s <code title="">mode</code>
 member if it is present, and <var title="">fallbackMode</var> otherwise.

 <li><p>If <var title="">mode</var> is non-null, set <var title="">request</var>'s
 <a title="concept-request-mode" href="#concept-request-mode">mode</a> to <var title="">mode</var>.

 <li><p>Let <var title="">credentials</var> be <var title="">init</var>'s
 <code title="">credentials</code> member if it is present, and
 <var title="">fallbackCredentials</var> otherwise.

 <li><p>If <var title="">credentials</var> is non-null, set <var title="">request</var>'s
 <a title="concept-request-credentials-mode" href="#concept-request-credentials-mode">credentials mode</a> to
 <var title="">credentials</var>.

 <li><p>Let <var title="">cache</var> be <var title="">init</var>'s <code title="">cache</code>
 member if it is present, and <var title="">fallbackCache</var> otherwise.

 <li><p>If <var title="">cache</var> is non-null, set <var title="">request</var>'s
 <a title="concept-request-cache-mode" href="#concept-request-cache-mode">cache mode</a> to <var title="">cache</var>.

 <li>
  <p>If <var title="">init</var>'s <code title="">method</code> member is present, let
  <var title="">method</var> be it and run these substeps:

  <ol>
   <li><p>If <var title="">method</var> is not a <a title="concept-method" href="#concept-method">method</a> or
   <var title="">method</var> is a <a href="#forbidden-method">forbidden method</a>,
   <a class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">TypeError</code>.

   <li><p><a title="concept-method-normalize" href="#concept-method-normalize">Normalize</a> <var title="">method</var>.

   <li><p>Set <var title="">request</var>'s <a title="concept-request-method" href="#concept-request-method">method</a>
   to <var title="">method</var>.
  </ol>

 <li><p>Let <var title="">r</var> be a new <code><a href="#request">Request</a></code> object associated with
 <var title="">request</var> and a new <code><a href="#headers">Headers</a></code> object.

 <li><p>Let <var title="">headers</var> be a copy of <var title="">r</var>'s
 <code><a href="#headers">Headers</a></code> object.
 <!-- it might contain a header that is no longer allowed per the mode change -->

 <li><p>If <var title="">init</var>'s <code title="">headers</code> member is present, set
 <var title="">headers</var> to <var title="">init</var>'s <code title="">headers</code> member.

 <li><p>Empty <var title="">r</var>'s <a title="concept-Request-request" href="#concept-request-request">request</a>'s
 <a title="concept-request-header-list" href="#concept-request-header-list">header list</a>.

 <li>
  <p>If <var title="">r</var>'s <a title="concept-Request-request" href="#concept-request-request">request</a>'s
  <a title="concept-request-mode" href="#concept-request-mode">mode</a> is "<code title="">no-cors</code>", run these
  substeps:

  <ol>
   <li><p>If <var title="">r</var>'s <a title="concept-Request-request" href="#concept-request-request">request</a>'s
   <a title="concept-request-method" href="#concept-request-method">method</a> is not a <a href="#simple-method">simple method</a>,
   <a class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">TypeError</code>.

   <li><p>Set <var title="">r</var>'s <code><a href="#headers">Headers</a></code> object's
   <a title="concept-Headers-guard" href="#concept-headers-guard">guard</a> to <i title="">request-no-CORS</i>.
  </ol>

 <li><p><a title="concept-Headers-fill" href="#concept-headers-fill">Fill</a> <var title="">r</var>'s
 <code><a href="#headers">Headers</a></code> object with <var title="">headers</var>. Rethrow any exceptions.

 <li>
  <p>If <var title="">init</var>'s <code title="">body</code> member is present, run these
  substeps:

  <ol>
   <li><p>If <var title="">request</var>'s <a title="concept-request-method" href="#concept-request-method">method</a>
   is `<code title="">GET</code>` or `<code title="">HEAD</code>`,
   <a class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">TypeError</code>.

   <li><p>Let <var title="">stream</var> and <var title="">Content-Type</var> be the result of
   <a title="concept-BodyInit-extract" href="#concept-bodyinit-extract">extracting</a> <var title="">init</var>'s
   <code title="">body</code> member.

   <li><p>Set <var title="">r</var>'s <a title="concept-Request-request" href="#concept-request-request">request</a>'s
   <a title="concept-request-body" href="#concept-request-body">body</a> to <var title="">stream</var>.

   <li><p>If <var title="">Content-Type</var> is non-null and <var title="">r</var>'s
   <a title="concept-Request-request" href="#concept-request-request">request</a>'s
   <a title="concept-request-header-list" href="#concept-request-header-list">header list</a> contains no
   <a title="concept-header" href="#concept-header">header</a> <a title="concept-header-name" href="#concept-header-name">named</a>
   `<code title="">Content-Type</code>`, <a title="concept-Headers-append" href="#concept-headers-append">append</a>
   `<code title="">Content-Type</code>`/<var title="">Content-Type</var> to <var title="">r</var>'s
   <code><a href="#headers">Headers</a></code> object. Rethrow any exception.
  </ol>

 <li><p>Set <var title="">r</var>'s <a title="concept-Body-MIME-type" href="#concept-body-mime-type">MIME type</a> to
 the result of <a title="concept-header-extract-MIME-type" href="#concept-header-extract-mime-type">extracting a MIME type</a>
 from <var title="">r</var>'s <a title="concept-Request-request" href="#concept-request-request">request</a>'s
 <a title="concept-request-header-list" href="#concept-request-header-list">header list</a>.

 <li><p>Return <var title="">r</var>.
</ol>

<p>The <dfn title="dom-Request-method" id="dom-request-method"><code>method</code></dfn> attribute's getter must
return <a title="concept-Request-request" href="#concept-request-request">request</a>'s
<a title="concept-request-method" href="#concept-request-method">method</a>.

<p>The <dfn title="dom-Request-url" id="dom-request-url"><code>url</code></dfn> attribute's getter must
return <a title="concept-Request-request" href="#concept-request-request">request</a>'s
<a title="concept-request-url" href="#concept-request-url">url</a>,
<a title="concept-url-serializer" class="external" href="https://url.spec.whatwg.org/#concept-url-serializer">serialized</a> with the
<i title="">exclude fragment flag</i> set.

<p>The <dfn title="dom-Request-headers" id="dom-request-headers"><code>headers</code></dfn> attribute's getter must
return the associated <code><a href="#headers">Headers</a></code> object.

<p>The <dfn title="dom-Request-context" id="dom-request-context"><code>context</code></dfn> attribute's getter must
return <a title="concept-Request-request" href="#concept-request-request">request</a>'s
<a title="concept-Request-context" href="#concept-request-context">context</a>.

<p>The <dfn title="dom-Request-referrer" id="dom-request-referrer"><code>referrer</code></dfn> attribute's getter must
return the empty string if <a title="concept-Request-request" href="#concept-request-request">request</a>'s
<a title="concept-Request-referrer" href="#concept-request-referrer">referrer</a> is <i title="">no referrer</i>,
"<code title="">about:client</code>" if <a title="concept-Request-request" href="#concept-request-request">request</a>'s
<a title="concept-Request-referrer" href="#concept-request-referrer">referrer</a> is <i title="">client</i> and
<a title="concept-Request-request" href="#concept-request-request">request</a>'s
<a title="concept-Request-referrer" href="#concept-request-referrer">referrer</a>,
<a title="concept-url-serializer" class="external" href="https://url.spec.whatwg.org/#concept-url-serializer">serialized</a>, otherwise.

<p>The <dfn title="dom-Request-mode" id="dom-request-mode"><code>mode</code></dfn> attribute's getter must
return the value corresponding to the first matching statement, switching on
<a title="concept-Request-request" href="#concept-request-request">request</a>'s
<a title="concept-request-mode" href="#concept-request-mode">mode</a>:

<dl class="switch">
 <dt>"<code title="">cors-with-forced-preflight</code>"
 <dd>"<code title="">cors</code>"
 <dt>Otherwise
 <dd>Value as is.
</dl>

<p>The <dfn title="dom-Request-credentials" id="dom-request-credentials"><code>credentials</code></dfn> attribute's
getter must return <a title="concept-Request-request" href="#concept-request-request">request</a>'s
<a title="concept-request-credentials-mode" href="#concept-request-credentials-mode">credentials mode</a>.

<p>The <dfn title="dom-Request-cache" id="dom-request-cache"><code>cache</code></dfn> attribute's getter must
return <a title="concept-Request-request" href="#concept-request-request">request</a>'s
<a title="concept-request-cache-mode" href="#concept-request-cache-mode">cache mode</a>.

<hr>

<p>The <dfn title="dom-Request-clone" id="dom-request-clone"><code>clone()</code></dfn> method, when invoked, must
run these steps:

<ol>
 <li><p>If <a title="concept-Body-used-flag" href="#concept-body-used-flag">used flag</a> is set,
 <a class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">TypeError</code>.

 <li><p>Let <var title="">newRequest</var> be a copy of
 <a title="concept-Request-request" href="#concept-request-request">request</a>, except that
 <var title="">newRequest</var>'s <a title="concept-request-body" href="#concept-request-body">body</a> is a tee of
 <a title="concept-Request-request" href="#concept-request-request">request</a>'s
 <a title="concept-request-body" href="#concept-request-body">body</a>.
 <!-- Similar text in: HTTP network or cache fetch -->

 <li><p>Let <var title="">r</var> be a new <code><a href="#request">Request</a></code> object associated with
 <var title="">newRequest</var> and a new <code><a href="#headers">Headers</a></code> object.

 <li><p>Return <var title="">r</var>.
</ol>


<h3 id="response-class"><span class="secno">5.4 </span>Response class</h3>

<pre class="idl">[<a title="dom-Response" href="#dom-response">Constructor</a>(optional <a href="#bodyinit">BodyInit</a> <var title="">body</var>, optional <a href="#responseinit">ResponseInit</a> <var title="">init</var>),
 Exposed=(Window,Worker)]
interface <dfn id="response">Response</dfn> {
  [NewObject] static <a href="#response">Response</a> <a title="dom-Response-error" href="#dom-response-error">error</a>();
  [NewObject] static <a href="#response">Response</a> <a title="dom-Response-redirect" href="#dom-response-redirect">redirect</a>(USVString <var title="">url</var>, optional unsigned short <var title="">status</var> = 302);

  readonly attribute <a href="#responsetype">ResponseType</a> <a title="dom-Response-type" href="#dom-response-type">type</a>;

  readonly attribute USVString <a title="dom-Response-url" href="#dom-response-url">url</a>;
           attribute boolean <a title="dom-Response-finalURL" href="#dom-response-finalurl">finalURL</a>;
  readonly attribute unsigned short <a title="dom-Response-status" href="#dom-response-status">status</a>;
  readonly attribute boolean <a title="dom-Response-ok" href="#dom-response-ok">ok</a>;
  readonly attribute ByteString <a title="dom-Response-statusText" href="#dom-response-statustext">statusText</a>;
  [SameObject] readonly attribute <a href="#headers">Headers</a> <a title="dom-Response-headers" href="#dom-response-headers">headers</a>;

  [NewObject] <a href="#response">Response</a> <a title="dom-Response-clone" href="#dom-response-clone">clone</a>();
};
<a href="#response">Response</a> implements <a href="#body">Body</a>;

dictionary <dfn id="responseinit">ResponseInit</dfn> {
  unsigned short status = 200;
  ByteString statusText = "OK";
  <a href="#headersinit">HeadersInit</a> headers;
};

enum <dfn id="responsetype">ResponseType</dfn> { "basic", "cors", "default", "error", "opaque" };</pre>

<p>A <code><a href="#response">Response</a></code> object has an associated
<dfn title="concept-Response-response" id="concept-response-response">response</dfn> (a
<a title="concept-response" href="#concept-response">response</a>).

<p>A <code><a href="#response">Response</a></code> object also has an associated <code><a href="#headers">Headers</a></code> object which
is itself associated with <a title="concept-Response-response" href="#concept-response-response">response</a>'s
<a title="concept-response-header-list" href="#concept-response-header-list">header list</a> and whose
<a title="concept-Headers-guard" href="#concept-headers-guard">guard</a> is <i title="">response</i>.

<p>A <code><a href="#response">Response</a></code> object's <a title="concept-Body-body" href="#concept-body-body">body</a> is its
<a title="concept-Response-response" href="#concept-response-response">response</a>'s
<a title="concept-response-body" href="#concept-response-body">body</a>.

<p>The
<dfn title="dom-Response" id="dom-response"><code>Response(<var>body</var>, <var>init</var>)</code></dfn>
constructor, when invoked, must run these steps:

<ol>
 <li><p>If <var title="">init</var>'s <code title="">status</code> member is not in the range
 200 to 599, <a class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">RangeError</code>.

 <li><p>If <var title="">init</var>'s <code title="">statusText</code> member does not match the
 <a class="external" href="http://tools.ietf.org/html/rfc2616/#section-6.1.1">Reason-Phrase</a> token production,
 <a class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">TypeError</code>.

 <li><p>Let <var title="">r</var> be a new <code><a href="#response">Response</a></code> object, associated with a
 new <a title="concept-response" href="#concept-response">response</a> and a new <code><a href="#headers">Headers</a></code> object.

 <li><p>Set <var title="">r</var>'s <a title="concept-Response-response" href="#concept-response-response">response</a>'s
 <a title="concept-response-status" href="#concept-response-status">status</a> to <var title="">init</var>'s
 <code title="">status</code> member.

 <li><p>Set <var title="">r</var>'s <a title="concept-Response-response" href="#concept-response-response">response</a>'s
 <a title="concept-response-status-message" href="#concept-response-status-message">status message</a> to
 <var title="">init</var>'s <code title="">statusText</code> member.

 <li>
  <p>If <var title="">init</var>'s <code title="">headers</code> member is present, run these
  substeps:

  <ol>
   <li><p>Empty <var title="">r</var>'s
   <a title="concept-Response-response" href="#concept-response-response">response</a>'s
   <a title="concept-response-header-list" href="#concept-response-header-list">header list</a>.

   <li><p><a title="concept-Headers-fill" href="#concept-headers-fill">Fill</a> <var title="">r</var>'s
   <code><a href="#headers">Headers</a></code> object with <var title="">init</var>'s <code title="">headers</code>
   member. Rethrow any exceptions.
  </ol>

 <li>
  <p>If <var title="">body</var> is given, run these substeps:

  <ol>
   <li><p>Let <var title="">stream</var> and <var title="">Content-Type</var> be the result of
   <a title="concept-BodyInit-extract" href="#concept-bodyinit-extract">extracting</a> <var title="">body</var>.

   <li><p>Set <var title="">r</var>'s <a title="concept-Response-response" href="#concept-response-response">response</a>'s
   <a title="concept-response-body" href="#concept-response-body">body</a> to <var title="">stream</var>.

   <li><p>If <var title="">Content-Type</var> is non-null and <var title="">r</var>'s
   <a title="concept-Response-response" href="#concept-response-response">response</a>'s
   <a title="concept-response-header-list" href="#concept-response-header-list">header list</a> contains no
   <a title="concept-header" href="#concept-header">header</a> <a title="concept-header-name" href="#concept-header-name">named</a>
   `<code title="">Content-Type</code>`, <a title="concept-header-list-append" href="#concept-header-list-append">append</a>
   `<code title="">Content-Type</code>`/<var title="">Content-Type</var> to
   <var title="">r</var>'s <a title="concept-Response-response" href="#concept-response-response">response</a>'s
   <a title="concept-response-header-list" href="#concept-response-header-list">header list</a>.
  </ol>

 <li><p>Set <var title="">r</var>'s <a title="concept-Body-MIME-type" href="#concept-body-mime-type">MIME type</a> to
 the result of <a title="concept-header-extract-MIME-type" href="#concept-header-extract-mime-type">extracting a MIME type</a>
 from <var title="">r</var>'s <a title="concept-Response-response" href="#concept-response-response">response</a>'s
 <a title="concept-response-header-list" href="#concept-response-header-list">header list</a>.

 <li><p>Set <var title="">r</var>'s <a title="concept-Response-response" href="#concept-response-response">response</a>'s
 <a title="concept-response-tls-state" href="#concept-response-tls-state">TLS state</a> to
 <a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#entry-settings-object">entry settings object</a>'s
 <span>TLS state</span>.
 <!-- XXX xref TLS state -->

 <li><p>Return <var title="">r</var>.
</ol>

<p>The static <dfn title="dom-Response-error" id="dom-response-error"><code>error()</code></dfn> method, when
invoked, must run return a new <code><a href="#response">Response</a></code> object, associated with a new
<a title="concept-network-error" href="#concept-network-error">network error</a> and a new <code><a href="#headers">Headers</a></code>
object.

<p>The static
<dfn title="dom-Response-redirect" id="dom-response-redirect"><code>redirect(<var>url</var>, <var>status</var>)</code></dfn>
method, when invoked, must run these steps:

<ol>
 <li><p>Let <var title="">parsedURL</var> be the result of
 <a title="concept-url-parser" class="external" href="https://url.spec.whatwg.org/#concept-url-parser">parsing</a>
 <var title="">url</var> with <a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#entry-settings-object">entry settings object</a>'s
 <a class="external" href="https://html.spec.whatwg.org/multipage/webappapis.html#api-base-url">API base URL</a>.

 <li><p>If <var title="">parsedURL</var> is failure,
 <a class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">TypeError</code>.

 <li><p>If <var title="">status</var> is not one of
 301,
 302,
 303,
 307, and
 308,
 <a class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">RangeError</code>.

 <li><p>Let <var title="">r</var> be a new <code><a href="#response">Response</a></code> object, associated with a
 new <a title="concept-response" href="#concept-response">response</a> and a new <code><a href="#headers">Headers</a></code> object.

 <li><p>Set <var title="">r</var>'s <a title="concept-Response-response" href="#concept-response-response">response</a>'s
 <a title="concept-response-status" href="#concept-response-status">status</a> to <var title="">status</var>.

 <li><p><a title="concept-header-list-set" href="#concept-header-list-set">Set</a> `<code title="">Location</code>` to
 <var title="">parsedURL</var>,
 <a title="concept-url-serializer" class="external" href="https://url.spec.whatwg.org/#concept-url-serializer">serialized</a> and
 <a title="utf-8 encode" class="external" href="https://encoding.spec.whatwg.org/#utf-8-encode">utf-8 encoded</a>, in
 <var title="">r</var>'s <a title="concept-Response-response" href="#concept-response-response">response</a>'s
 <a title="concept-response-header-list" href="#concept-response-header-list">header list</a>.

 <li><p>Return <var title="">r</var>.
</ol>

<p>The <dfn title="dom-Response-type" id="dom-response-type"><code>type</code></dfn> attribute's getter must return
<a title="concept-Response-response" href="#concept-response-response">response</a>'s
<a title="concept-response-type" href="#concept-response-type">type</a>.

<p>The <dfn title="dom-Response-url" id="dom-response-url"><code>url</code></dfn> attribute's getter must return
the empty string if <a title="concept-Response-response" href="#concept-response-response">response</a>'s
<a title="concept-response-url" href="#concept-response-url">url</a> is null and
<a title="concept-Response-response" href="#concept-response-response">response</a>'s
<a title="concept-response-url" href="#concept-response-url">url</a>,
<a title="concept-url-serializer" class="external" href="https://url.spec.whatwg.org/#concept-url-serializer">serialized</a> with the
<i title="">exclude fragment flag</i> set, otherwise.
<a href="#refsURL">[URL]</a>

<p>The <dfn title="dom-Response-finalURL" id="dom-response-finalurl"><code>finalURL</code></dfn> attribute's setter
must run these steps:

<ol>
 <li><p>If <a title="concept-Response-response" href="#concept-response-response">response</a>'s
 <a title="concept-response-url" href="#concept-response-url">url</a> is null,
 <a class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">TypeError</code>.

 <li><p>If the given value is true, set
 <a title="concept-Response-response" href="#concept-response-response">response</a>'s
 <a title="concept-response-final-url-flag" href="#concept-response-final-url-flag">final url flag</a>, and unset it
 otherwise.
</ol>

<p>The <code title="dom-Response-finalURL"><a href="#dom-response-finalurl">finalURL</a></code> attribute's getter must return
true if <a title="concept-Response-response" href="#concept-response-response">response</a>'s
<a title="concept-response-final-url-flag" href="#concept-response-final-url-flag">final url flag</a> is set, and false
otherwise.

<p>The <dfn title="dom-Response-status" id="dom-response-status"><code>status</code></dfn> attribute's getter must
return <a title="concept-Response-response" href="#concept-response-response">response</a>'s
<a title="concept-response-status" href="#concept-response-status">status</a>.

<p>The <dfn title="dom-Response-ok" id="dom-response-ok"><code>ok</code></dfn> attribute's getter must
return true if <a title="concept-Response-response" href="#concept-response-response">response</a>'s
<a title="concept-response-status" href="#concept-response-status">status</a> is in the range 200 to 299, and false
otherwise.

<p>The <dfn title="dom-Response-statusText" id="dom-response-statustext"><code>statusText</code></dfn> attribute's getter
must return <a title="concept-Response-response" href="#concept-response-response">response</a>'s
<a title="concept-response-status-message" href="#concept-response-status-message">status message</a>.

<p>The <dfn title="dom-Response-headers" id="dom-response-headers"><code>headers</code></dfn> attribute's getter must
return the associated <code><a href="#headers">Headers</a></code> object.

<hr>

<p>The <dfn title="dom-Response-clone" id="dom-response-clone"><code>clone()</code></dfn> method, when invoked, must
run these steps:

<ol>
 <li><p>If <a title="concept-Body-used-flag" href="#concept-body-used-flag">used flag</a> is set,
 <a class="external" href="http://heycam.github.io/webidl/#dfn-throw">throw</a> a <code title="">TypeError</code>.

 <li><p>Let <var title="">newResponse</var> be a copy of
 <a title="concept-Response-response" href="#concept-response-response">response</a>, except that
 <var title="">newResponse</var>'s <a title="concept-response-body" href="#concept-response-body">body</a> is a tee of
 <a title="concept-Response-response" href="#concept-response-response">response</a>'s
 <a title="concept-response-body" href="#concept-response-body">body</a>.
 <!-- Similar text in: HTTP network or cache fetch -->

 <li><p>Let <var title="">r</var> be a new <code><a href="#response">Response</a></code> object associated with
 <var title="">newResponse</var> and a new <code><a href="#headers">Headers</a></code> object.

 <li><p>Return <var title="">r</var>.
</ol>


<h3 id="structured-cloning-of-headers,-request,-and-response-objects"><span class="secno">5.5 </span>Structured cloning of <code><a href="#headers">Headers</a></code>, <code><a href="#request">Request</a></code>, and <code><a href="#response">Response</a></code> objects</h3>

<p class="note">Unlikely to happen anytime soon due to difficulty of cloning promises and
streams. See <a href="https://github.com/slightlyoff/ServiceWorker/issues/313">SW #313</a>
for details.


<h3 id="fetch-method"><span class="secno">5.6 </span>Fetch method</h3>

<pre class="idl">[NoInterfaceObject,
 Exposed=(Window,Worker)]
interface <dfn id="globalfetch">GlobalFetch</dfn> {
  [NewObject] Promise&lt;<a href="#response">Response</a>&gt; <a title="dom-global-fetch" href="#dom-global-fetch">fetch</a>(<a href="#requestinfo">RequestInfo</a> <var title="">input</var>, optional <a href="#requestinit">RequestInit</a> <var title="">init</var>);
};
<a class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#window">Window</a> implements <a href="#globalfetch">GlobalFetch</a>;
<a class="external" href="https://html.spec.whatwg.org/multipage/workers.html#workerglobalscope">WorkerGlobalScope</a> implements <a href="#globalfetch">GlobalFetch</a>;</pre>

<p>The
<dfn title="dom-global-fetch" id="dom-global-fetch"><code>fetch(<var>input</var>, <var>init</var>)</code></dfn>
method, must run these steps:

<ol>
 <li><p>Let <var title="">p</var> be a new promise.

 <li><p>Let <var title="">r</var> be the associated
 <a title="concept-request" href="#concept-request">request</a> of the result of invoking the initial value of
 <code title="dom-Request"><a href="#dom-request">Request</a></code> as constructor with <var title="">input</var> and
 <var title="">init</var> as arguments. If this throws an exception, reject
 <var title="">p</var> with it.

 <li>
  <p>Run the following <a class="external" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel">in parallel</a>:

  <p><a title="concept-fetch" href="#concept-fetch">Fetch</a> <var title="">r</var>.

  <p>To <a href="#process-response">process response</a> for <var title="">response</var>, run these substeps:

  <ol>
   <li><p>If <var title="">response</var>'s <a title="concept-response-type" href="#concept-response-type">type</a> is
   <i title="">error</i>, reject <var title="">p</var> with a <code title="">TypeError</code>.

   <li><p>Otherwise, resolve <var title="">p</var> with new <code><a href="#response">Response</a></code> object
   associated with <var title="">response</var>.
  </ol>

  <p>To <a href="#process-response-body">process response body</a> for <var title="">response</var>, do nothing.

  <p>To <a href="#process-response-end-of-file">process response end-of-file</a> for <var title="">response</var>,
  do nothing.

 <li><p>Return <var title="">p</var>.
</ol>



<!-- XMLHttpRequest API -->



<h2 class="no-num" id="background-reading">Background reading</h2>

<p><em>This section and its subsections are informative only.</em>

<h3 class="no-num" id="http-header-layer-division"><dfn>HTTP header layer division</dfn></h3>

<p>For the purposes of fetching, the platform has an API layer (HTML's
<code title="">img</code>, CSS' <code title="">background-image</code>), service worker layer,
and network &amp; cache layer. `<code title="http-accept">Accept</code>` and
`<code title="http-accept-language">Accept-Language</code>` are set at the API layer
(typically by the user agent). Most other headers controlled by the user agent, such as
`<code title="http-accept-encoding">Accept-Encoding</code>`,
`<code title="http-host">Host</code>`, and `<code title="http-referer">Referer</code>`, are
set in the network &amp; cache layer. Developers can set headers either at the API layer
or in the service worker layer (typically through a <code><a href="#request">Request</a></code> object).
Developers have almost no control over
<a title="forbidden header name" href="#forbidden-header-name">forbidden headers</a>, but can control
`<code title="http-accept">Accept</code>` and have the means to constrain and disable
`<code title="http-referer">Referer</code>` for instance.


<h3 class="no-num" id="atomic-http-redirect-handling">Atomic HTTP redirect handling</h3>

<p>Throughout the platform, redirects (a
<a title="concept-response" href="#concept-response">response</a> whose
<a title="concept-response-status" href="#concept-response-status">status</a> is one of 301, 302, 303, 307, and 308)
are not exposed to APIs. Exposing redirects might leak information not otherwise available
through a cross-site scripting attack.

<p class="example">A fetch to <code>https://example.org/auth</code> that includes a
<code title="">Cookie</code> marked <code title="">HttpOnly</code> could result in a redirect to
<code>https://other-origin.invalid/4af955781ea1c84a3b11</code>. This new URL contains a
secret. If we expose redirects that secret would be available through a cross-site
scripting attack.


<h3 class="no-num" id="basic-safe-cors-protocol-setup">Basic safe CORS protocol setup</h3>

<p>For resources where data is protected through IP authentication or a firewall
(unfortunately relatively common still), using the <a href="#cors-protocol">CORS protocol</a> is
<strong>unsafe</strong>. (This is the reason why the <a href="#cors-protocol">CORS protocol</a> had to be
invented.)

<p>However, otherwise using the following <a title="concept-header" href="#concept-header">header</a> is:

<pre>Access-Control-Allow-Origin: *</pre>

<p>Even if a resource exposes additional information based on cookie or HTTP
authentication, using the above <a title="concept-header" href="#concept-header">header</a> will not reveal
it. It will share the resource with APIs such as
<code class="external"><a href="https://xhr.spec.whatwg.org/#xmlhttprequest">XMLHttpRequest</a></code>, much like it is already shared with
<code title="">curl</code> and <code title="">wget</code>.

<p>Thus in other words, if a resource cannot be accessed from a random device connected to
the web using <code title="">curl</code> and <code title="">wget</code> the aforementioned
<a title="concept-header" href="#concept-header">header</a> is not to be included. If it can be accessed
however, it is perfectly fine to do so.


<h3 class="no-num" id="cors-protocol-and-http-caches">CORS protocol and HTTP caches</h3>

<p>If <a href="#cors-protocol">CORS protocol</a> requirements are more complicated than setting
`<code title="http-access-control-allow-origin"><a href="#http-access-control-allow-origin">Access-Control-Allow-Origin</a></code>` to
<code title="">*</code> or a static <a class="external" href="https://html.spec.whatwg.org/multipage/browsers.html#origin">origin</a>,
`<code title="">Vary</code>` is to be used.
<a href="#refsHTML">[HTML]</a>
<a href="#refsHTTP">[HTTP]</a>

<pre class="example">Vary: Access-Control-Allow-Origin</pre>




<h2 class="no-num" id="references">References</h2>
<div id="anolis-references"><dl><dt id="refsCOOKIES">[COOKIES]
<dd><cite><a href="http://tools.ietf.org/html/rfc6265">HTTP State Management Mechanism</a></cite>, Adam Barth. IETF.

<dt id="refsCORS">[CORS]
<dd>(Non-normative) <cite><a href="http://www.w3.org/TR/cors/">CORS (obsolete)</a></cite>, Anne van Kesteren. W3C.

<dt id="refsCSP">[CSP]
<dd><cite><a href="https://w3c.github.io/webappsec/specs/content-security-policy/">Content Security Policy</a></cite>, Mike West, Adam Barth and Dan Veditz. W3C.

<dt id="refsDATAURL">[DATAURL]
<dd><cite><a href="http://simonsapin.github.io/data-urls/">The data URL scheme</a></cite>, Simon Sapin.

<dt id="refsENCODING">[ENCODING]
<dd><cite><a href="https://encoding.spec.whatwg.org/">Encoding</a></cite>, Anne van Kesteren. WHATWG.

<dt id="refsHSTS">[HSTS]
<dd><cite><a href="http://tools.ietf.org/html/rfc6797">HTTP Strict Transport Security</a></cite>, Jeff Hodges, Collin Jackson and Adam Barth. IETF.

<dt id="refsHTML">[HTML]
<dd><cite><a href="https://html.spec.whatwg.org/multipage/">HTML</a></cite>, Ian Hickson. WHATWG.

<dt id="refsHTTP">[HTTP]
<dd><cite><a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a></cite>, Roy Fielding, James Gettys, Jeffrey Mogul et al.. IETF.

<dt id="refsHTTPAUTH">[HTTPAUTH]
<dd><cite><a href="http://tools.ietf.org/html/rfc2617">HTTP Authentication: Basic and Digest Access Authentication</a></cite>, J. Franks, Phillip Hallam-Baker, J. Hostetler et al.. IETF.

<dt id="refsHTTPVERBSEC">[HTTPVERBSEC]
<dd>(Non-normative) <cite><a href="http://www.kb.cert.org/vuls/id/867593">Multiple vendors' web servers enable HTTP TRACE method by default</a></cite>. US-CERT.

<dd>(Non-normative) <cite><a href="http://www.kb.cert.org/vuls/id/288308">Microsoft Internet Information Server (IIS) vulnerable to cross-site scripting via HTTP TRACK method</a></cite>. US-CERT.

<dd>(Non-normative) <cite><a href="http://www.kb.cert.org/vuls/id/150227">HTTP proxy default configurations allow arbitrary TCP connections</a></cite>. US-CERT.

<dt id="refsMIX">[MIX]
<dd><cite><a href="https://w3c.github.io/webappsec/specs/mixedcontent/">Mixed Content</a></cite>, Mike West. W3C.

<dt id="refsORIGIN">[ORIGIN]
<dd>(Non-normative) <cite><a href="http://tools.ietf.org/html/rfc6454">The Web Origin Concept</a></cite>, Adam Barth. IETF.

<dt id="refsREFERRER">[REFERRER]
<dd><cite><a href="https://w3c.github.io/webappsec/specs/referrer-policy/">Referrer Policy</a></cite>, Jochen Eisinger and Mike West. W3C.

<dt id="refsRFC2119">[RFC2119]
<dd><cite><a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a></cite>, Scott Bradner. IETF.

<dt id="refsRFC2388">[RFC2388]
<dd><cite><a href="http://tools.ietf.org/html/rfc2388">Returning Values from Forms: multipart/form-data</a></cite>, L. Masinter. IETF.

<dt id="refsSW">[SW]
<dd><cite><a href="https://slightlyoff.github.io/ServiceWorker/spec/service_worker/">Service Workers</a></cite>, Alex Russell and Jungkee Song. W3C.

<dt id="refsTLS">[TLS]
<dd><cite><a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a></cite>, T. Dierks and E. Rescorla. IETF.

<dt id="refsURL">[URL]
<dd><cite><a href="https://url.spec.whatwg.org/">URL</a></cite>, Anne van Kesteren. WHATWG.

<dt id="refsXHR">[XHR]
<dd>(Non-normative) <cite><a href="https://xhr.spec.whatwg.org/">XMLHttpRequest</a></cite>, Anne van Kesteren. WHATWG.

</dl></div>



<h2 class="no-num" id="acknowledgments">Acknowledgments</h2>

<p>Thanks to
Adam Barth,
Alexey Proskuryakov,
Ángel González,
Anssi Kostiainen,
Arkadiusz Michalski,
Arne Johannessen,
Arthur Barstow,
Axel Rauschmayer,
Ben Kelly,
Benjamin Hawkes-Lewis,
Bert Bos,
Björn Höhrmann,
Boris Zbarsky,
Brad Hill,
Brad Porter,
Cameron McCormack,
Clement Pellerin,
Collin Jackson,
David Håsäther,
David Orchard,
Domenic Denicola,
Dean Jackson,
Eric Lawrence,
Frank Ellerman,
Frederick Hirsch,
Gavin Carothers,
Glenn Maynard,
Graham Klyne,
Hal Lockhart,
Hallvord R. M. Steen,
Henri Sivonen,
Honza Bambas,
Ian Hickson,
Jake Archibald<!-- technically B.J. Archibald -->,
James Graham,
Janusz Majnert,
Jeff Hodges,
Jeffrey Yasskin,
Jesse M. Heines,
Jonas Sicking,
Julian Reschke,
송정기 (Jungkee Song),
Jussi Kalliokoski,
Kenji Baheux,
Lachlan Hunt,
Lucas Gonze,
呂康豪 (Kang-Hao Lu),
Maciej Stachowiak,
Marc Silbey,
Marcos Caceres,
Mark Nottingham,
Mark S. Miller,
Martin Dürst,
Matt Andrews,
Matt Falkenhagen,
Matt Oshry,
Matt Womer,
Mhano Harkness,
Michael Smith,
Mike West,
Mohamed Zergaoui,
Nikhil Marathe,
Nikunj Mehta,
Odin Hørthe Omdal,
Ondřej Žára,
Philip Jägenstedt,
R. Auburn,
Sharath Udupa,
Shivakumar Jagalur Matt,
Simon Pieters,
Sunava Dutta,
Surya Ismail,
吉野剛史 (Takeshi Yoshino),
Thomas Roessler,
Tobie Langel,
Tomás Aparicio,
保呂毅 (Tsuyoshi Horo),
Tyler Close,
Vladimir Dzhuvinov,
Wayne Carr, and
Zhenbin Xu
for being awesome.

<p>This standard is written by
<a lang="nl" href="//annevankesteren.nl/">Anne van Kesteren</a>
(<a href="//www.mozilla.org/">Mozilla</a>,
<a href="mailto:annevk@annevk.nl">annevk@annevk.nl</a>).

<p>Per <a rel="license" href="//creativecommons.org/publicdomain/zero/1.0/">CC0</a>, to
the extent possible under law, the editor has waived all copyright and related or
neighboring rights to this work.

<script id="head" src="//resources.whatwg.org/dfn.js"></script>
